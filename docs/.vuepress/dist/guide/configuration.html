<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.35">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" type="image/x-icon" sizes="32x32" href="/favicon.ico"><title>Configuration | go-doudou</title><meta name="description" content="Gossip Protocol Decentralized Golang Microservice Framework">
    <link rel="modulepreload" href="/assets/app.594cd40c.js"><link rel="modulepreload" href="/assets/configuration.html.3fb47554.js"><link rel="modulepreload" href="/assets/configuration.html.5b31b136.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/assets/style.39b9fc7e.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/logo.png" alt="go-doudou"><span class="site-name can-hide">go-doudou</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/guide/" class="router-link-active" aria-label="Guide"><!--[--><!--]--> Guide <!--[--><!--]--></a></div><div class="navbar-item"><a href="/resources/" class="" aria-label="Resources"><!--[--><!--]--> Resources <!--[--><!--]--></a></div><div class="navbar-item"><a href="/contribution/" class="" aria-label="Contribution"><!--[--><!--]--> Contribution <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="v1.x"><span class="title">v1.x</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="v1.x"><span class="title">v1.x</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/unionj-cloud/go-doudou/blob/v0.9.8/README.md" rel="noopener noreferrer" target="_blank" aria-label="v0.x"><!--[--><!--]--> v0.x <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/unionj-cloud/go-doudou/releases" rel="noopener noreferrer" target="_blank" aria-label="Release Notes"><!--[--><!--]--> Release Notes <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/guide/configuration.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/guide/configuration.html" class="" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/unionj-cloud/go-doudou" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/guide/" class="router-link-active" aria-label="Guide"><!--[--><!--]--> Guide <!--[--><!--]--></a></div><div class="navbar-item"><a href="/resources/" class="" aria-label="Resources"><!--[--><!--]--> Resources <!--[--><!--]--></a></div><div class="navbar-item"><a href="/contribution/" class="" aria-label="Contribution"><!--[--><!--]--> Contribution <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="v1.x"><span class="title">v1.x</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="v1.x"><span class="title">v1.x</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/unionj-cloud/go-doudou/blob/v0.9.8/README.md" rel="noopener noreferrer" target="_blank" aria-label="v0.x"><!--[--><!--]--> v0.x <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/unionj-cloud/go-doudou/releases" rel="noopener noreferrer" target="_blank" aria-label="Release Notes"><!--[--><!--]--> Release Notes <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/guide/configuration.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/guide/configuration.html" class="" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/unionj-cloud/go-doudou" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">Guide <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/guide/" class="router-link-active sidebar-item" aria-label="Introduction"><!--[--><!--]--> Introduction <!--[--><!--]--></a><!----></li><li><a href="/guide/getting-started.html" class="sidebar-item" aria-label="Getting Started"><!--[--><!--]--> Getting Started <!--[--><!--]--></a><!----></li><li><a href="/guide/idl.html" class="sidebar-item" aria-label="Define API"><!--[--><!--]--> Define API <!--[--><!--]--></a><!----></li><li><a href="/guide/cli.html" class="sidebar-item" aria-label="CLI"><!--[--><!--]--> CLI <!--[--><!--]--></a><!----></li><li><a href="/guide/generation.html" class="sidebar-item" aria-label="Generation Behaviors"><!--[--><!--]--> Generation Behaviors <!--[--><!--]--></a><!----></li><li><a href="/guide/rest.html" class="sidebar-item" aria-label="RESTful"><!--[--><!--]--> RESTful <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/configuration.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Configuration"><!--[--><!--]--> Configuration <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guide/configuration.html#local-configuration-file" class="router-link-active router-link-exact-active sidebar-item" aria-label="Local Configuration File"><!--[--><!--]--> Local Configuration File <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guide/configuration.html#dotenv-file" class="router-link-active router-link-exact-active sidebar-item" aria-label="Dotenv File"><!--[--><!--]--> Dotenv File <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/configuration.html#yaml-file" class="router-link-active router-link-exact-active sidebar-item" aria-label="Yaml File"><!--[--><!--]--> Yaml File <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/guide/configuration.html#remote-configuration-solution" class="router-link-active router-link-exact-active sidebar-item" aria-label="Remote Configuration Solution"><!--[--><!--]--> Remote Configuration Solution <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guide/configuration.html#nacos-configuration-center" class="router-link-active router-link-exact-active sidebar-item" aria-label="Nacos Configuration Center"><!--[--><!--]--> Nacos Configuration Center <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/configuration.html#apollo-configuration-center" class="router-link-active router-link-exact-active sidebar-item" aria-label="Apollo Configuration Center"><!--[--><!--]--> Apollo Configuration Center <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/guide/configuration.html#service-configuration" class="router-link-active router-link-exact-active sidebar-item" aria-label="Service Configuration"><!--[--><!--]--> Service Configuration <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/configuration.html#memberlist-configuration" class="router-link-active router-link-exact-active sidebar-item" aria-label="Memberlist Configuration"><!--[--><!--]--> Memberlist Configuration <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/configuration.html#nacos-configuration" class="router-link-active router-link-exact-active sidebar-item" aria-label="Nacos Configuration"><!--[--><!--]--> Nacos Configuration <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guide/configuration.html#apollo-configuration" class="router-link-active router-link-exact-active sidebar-item" aria-label="Apollo Configuration"><!--[--><!--]--> Apollo Configuration <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/guide/deployment.html" class="sidebar-item" aria-label="Deployment"><!--[--><!--]--> Deployment <!--[--><!--]--></a><!----></li><li><a href="/guide/migration.html" class="sidebar-item" aria-label="Migrating from v0.x"><!--[--><!--]--> Migrating from v0.x <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration" aria-hidden="true">#</a> Configuration</h1><p>Go-doudou supports dotenv and yaml format local configuration file, and Alibaba Nacos configuration center and Ctrip Apollo configuration center out-of-box. Go-doudou loads configuration from these sources to environment variables.</p><p>Comparing with remote configuration center local configuration files have higher priority, so value of each environment variable loaded from local files won&#39;t be overridden by configuration from remote center.</p><h2 id="local-configuration-file" tabindex="-1"><a class="header-anchor" href="#local-configuration-file" aria-hidden="true">#</a> Local Configuration File</h2><p>The usage of dotenv and yaml files are the same, only naming rules are different. They will be explained separately below.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Files with different format can be used together, or you can use only one kind of format. If used together, yaml files have higher priority. After all yaml files loaded, dotenv files loads.</p></div><h3 id="dotenv-file" tabindex="-1"><a class="header-anchor" href="#dotenv-file" aria-hidden="true">#</a> Dotenv File</h3><p>If you have multiple <code>.env</code> files, such as <code>.env.test</code>, <code>.env.prod</code> to configure different environment, you can set <code>GDD_ENV</code> environment variable to <code>test</code> or <code>prod</code> by terminal, <code>Dockerfile</code> or k8s file to load corresponding file.</p><p>Configuration Loading Rule:</p><ol><li>For one environment variable, no matter where be configured, first value has highest priority, won&#39;t be overridden by later values</li><li>Using <code>prod</code> as example, loading order is:<br> 1. Load <code>.env.prod.local</code><br> 2. If <code>GDD_ENV</code> != <code>test</code>, load <code>.env.local</code><br> 3. Load <code>.env.prod</code><br> 4. Load <code>.env</code></li></ol><p><strong>Note</strong>：file name must be prefixed with <code>.env</code></p><h3 id="yaml-file" tabindex="-1"><a class="header-anchor" href="#yaml-file" aria-hidden="true">#</a> Yaml File</h3><p>Support both <code>.yml</code> suffixed and <code>.yaml</code> suffixed files. If you have multiple yaml files, such as <code>app-test.yml</code>, <code>app-prod.yml</code> to configure different environment, you can set <code>GDD_ENV</code> environment variable to <code>test</code> or <code>prod</code> by terminal, <code>Dockerfile</code> or k8s file to load corresponding file.</p><p>Configuration Loading Rule:</p><ol><li>For one environment variable, no matter where be configured, first value has highest priority, won&#39;t be overridden by later values</li><li>Using <code>prod</code> as example, loading order is:<br> 1. Load <code>app-prod-local.yml</code><br> 2. If <code>GDD_ENV</code> != <code>test</code>, load <code>app-local.yml</code><br> 3. Load <code>app-prod.yml</code><br> 4. Load <code>app.yml</code></li></ol><p><strong>Note</strong>：file name must be prefixed with <code>app</code></p><h2 id="remote-configuration-solution" tabindex="-1"><a class="header-anchor" href="#remote-configuration-solution" aria-hidden="true">#</a> Remote Configuration Solution</h2><p>Go-doudou has built-in support for two remote configuration solution: Nacos from Alibaba and Apollo from Ctrip to load configuration when start and customize listener to react to config change event.</p><p>To enable remote configuration support, you should configure below environment variable in local configuration file:</p><ul><li><code>GDD_CONFIG_REMOTE_TYPE</code>: remote configuration center name，options：<code>nacos</code>，<code>apollo</code></li></ul><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>There are some go-doudou native configuration (<code>GDD_</code> prefixed) in <a href="#service-configuration">Service Configuration</a> and <a href="#memberlist-configuration">Memberlist Configuration</a> supporting be configured in runtime by reacting to change event from remote configuration center. Dynamic configuration have highest priority, can override old configuration from any other sources.</p></div><h3 id="nacos-configuration-center" tabindex="-1"><a class="header-anchor" href="#nacos-configuration-center" aria-hidden="true">#</a> Nacos Configuration Center</h3><p>Go-doudou will load configuration from Nacos server when service start out-of-box. You just need to add some configuration in local configuration files.</p><ul><li><code>GDD_NACOS_NAMESPACE_ID</code>: Nacos namespaceId, not required</li><li><code>GDD_NACOS_SERVER_ADDR</code>: Nacos server connection url, required</li><li><code>GDD_NACOS_CONFIG_FORMAT</code>: configuration data format, options: <code>dotenv</code>(default), <code>yaml</code></li><li><code>GDD_NACOS_CONFIG_GROUP</code>: Nacos group, default is <code>DEFAULT_GROUP</code></li><li><code>GDD_NACOS_CONFIG_DATAID</code>: Nacos dataId, required, multiple dataId should be separated by comma. Loading order is the same as configuration order, so first loaded value has highest priority.</li></ul><p>There is exported singleton <code>NacosClient</code> from <code>configmgr</code> for communicating with Nacos configuration center, you can call <code>AddChangeListener</code> method to add custom event listener. For example:</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> configmgr.NacosClient != </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">		configmgr.NacosClient.</span><span style="color:#DCDCAA;">AddChangeListener</span><span style="color:#D4D4D4;">(configmgr.NacosConfigListenerParam{</span></span>
<span class="line"><span style="color:#D4D4D4;">			DataId: </span><span style="color:#CE9178;">&quot;statsvc-dev&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">			OnChange: </span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(event *configmgr.NacosChangeEvent) {</span></span>
<span class="line"><span style="color:#D4D4D4;">				fmt.</span><span style="color:#DCDCAA;">Println</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;group:&quot;</span><span style="color:#D4D4D4;"> + event.Group + </span><span style="color:#CE9178;">&quot;, dataId:&quot;</span><span style="color:#D4D4D4;"> + event.DataId + fmt.</span><span style="color:#DCDCAA;">Sprintf</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;, changes: </span><span style="color:#9CDCFE;">%+v</span><span style="color:#D7BA7D;">\n</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">, event.Changes))</span></span>
<span class="line"><span style="color:#D4D4D4;">			},</span></span>
<span class="line"><span style="color:#D4D4D4;">		})</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="apollo-configuration-center" tabindex="-1"><a class="header-anchor" href="#apollo-configuration-center" aria-hidden="true">#</a> Apollo Configuration Center</h3><p>Go-doudou will load configuration from Apollo server when service start out-of-box. You just need to add some configuration in local configuration files.</p><ul><li><code>GDD_APOLLO_CLUSTER</code>: Apollo cluster, default is <code>default</code></li><li><code>GDD_APOLLO_ADDR</code>: Apollo server connection url, required</li><li><code>GDD_APOLLO_NAMESPACE</code>: Apollo namespace, just like dataId for Nacos, default is <code>application.properties</code>, multiple dataId should be separated by comma. Loading order is the same as configuration order, so first loaded value has highest priority.</li><li><code>GDD_APOLLO_SECRET</code>: Apollo secret, not required</li></ul><p>There is exported singleton <code>ApolloClient</code> from <code>configmgr</code> for communicating with Nacos configuration center, you can call <code>AddChangeListener</code> method to add custom event listener. For example:</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">type</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">ConfigChangeListener</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">struct</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">	configmgr.BaseApolloListener</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> (c *ConfigChangeListener) </span><span style="color:#DCDCAA;">OnChange</span><span style="color:#D4D4D4;">(event *storage.ChangeEvent) {</span></span>
<span class="line"><span style="color:#D4D4D4;">	c.Lock.</span><span style="color:#DCDCAA;">Lock</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> c.Lock.</span><span style="color:#DCDCAA;">Unlock</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> !c.SkippedFirstEvent {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">c.SkippedFirstEvent</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">true</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">	logger.</span><span style="color:#DCDCAA;">Info</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;from OnChange&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">	fmt.</span><span style="color:#DCDCAA;">Println</span><span style="color:#D4D4D4;">(event.Changes)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">value</span><span style="color:#D4D4D4;"> := </span><span style="color:#C586C0;">range</span><span style="color:#D4D4D4;"> event.Changes {</span></span>
<span class="line"><span style="color:#D4D4D4;">		fmt.</span><span style="color:#DCDCAA;">Println</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;change key : &quot;</span><span style="color:#D4D4D4;">, key, </span><span style="color:#CE9178;">&quot;, value :&quot;</span><span style="color:#D4D4D4;">, value)</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">	fmt.</span><span style="color:#DCDCAA;">Println</span><span style="color:#D4D4D4;">(event.Namespace)</span></span>
<span class="line"><span style="color:#D4D4D4;">	logger.</span><span style="color:#DCDCAA;">Info</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;from OnChange end&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#569CD6;">var</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">listener</span><span style="color:#D4D4D4;"> ConfigChangeListener</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	configmgr.ApolloClient.</span><span style="color:#DCDCAA;">AddChangeListener</span><span style="color:#D4D4D4;">(&amp;listener)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>Here is additional note: custom event listener will also react to the very first configuration loading event when service start, if you need to skip it, you should &quot;extend&quot; <code>BaseApolloListener</code> struct from <code>configmgr</code> package, then add below code to the beginning of <code>OnChange</code> function</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">c.Lock.</span><span style="color:#DCDCAA;">Lock</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> c.Lock.</span><span style="color:#DCDCAA;">Unlock</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> !c.SkippedFirstEvent {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">c.SkippedFirstEvent</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">true</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="service-configuration" tabindex="-1"><a class="header-anchor" href="#service-configuration" aria-hidden="true">#</a> Service Configuration</h2><p>Red asterisk marked configuration can be dynamically changed in runtime by go-doudou listening to change events from remote configuration center.</p><table><thead><tr><th>Environment Variable</th><th>Description</th><th>Default</th><th>Required</th></tr></thead><tbody><tr><td>GDD_BANNER</td><td>whether output banner to stdout or not to console</td><td>true</td><td></td></tr><tr><td>GDD_BANNER_TEXT</td><td></td><td>Go-doudou</td><td></td></tr><tr><td>GDD_LOG_LEVEL</td><td>possible values are panic, fatal, error, warn, warning, info, debug, trace</td><td>info</td><td></td></tr><tr><td>GDD_LOG_FORMAT</td><td>set log format to text or json, possible values are text and json</td><td>text</td><td></td></tr><tr><td>GDD_LOG_REQ_ENABLE</td><td>enable request and response logging</td><td>false</td><td></td></tr><tr><td>GDD_GRACE_TIMEOUT</td><td>graceful shutdown timeout for http server</td><td>15s</td><td></td></tr><tr><td>GDD_WRITE_TIMEOUT</td><td>http server connection write timeout</td><td>15s</td><td></td></tr><tr><td>GDD_READ_TIMEOUT</td><td>http server connection read timeout</td><td>15s</td><td></td></tr><tr><td>GDD_IDLE_TIMEOUT</td><td>http server connection idle timeout</td><td>60s</td><td></td></tr><tr><td>GDD_ROUTE_ROOT_PATH</td><td>prefix string to each of http api routes</td><td></td><td></td></tr><tr><td>GDD_SERVICE_NAME</td><td>service name</td><td></td><td>Yes</td></tr><tr><td>GDD_HOST</td><td>host for the http server to listen on</td><td></td><td></td></tr><tr><td>GDD_PORT</td><td>port for the http server to listen on</td><td>6060</td><td></td></tr><tr><td>GDD_RETRY_COUNT</td><td>client retry count</td><td>0</td><td></td></tr><tr><td>GDD_MANAGE_ENABLE</td><td>enable built-in api endpoints such as <code>/go-doudou/doc</code>, <code>/go-doudou/openapi.json</code>, <code>/go-doudou/prometheus</code>, <code>/go-doudou/registry</code> and <code>/go-doudou/config</code></td><td>true</td><td></td></tr><tr><td><span style="color:red;font-weight:bold;">*</span>GDD_MANAGE_USER</td><td>http basic username for built-in api endpoints</td><td>admin</td><td></td></tr><tr><td><span style="color:red;font-weight:bold;">*</span>GDD_MANAGE_PASS</td><td>http basic password for built-in api endpoints</td><td>admin</td><td></td></tr><tr><td>GDD_TRACING_METRICS_ROOT</td><td>metrics root for jaeger tracing</td><td>Go-doudou</td><td></td></tr><tr><td>GDD_WEIGHT</td><td>service instance weight</td><td>1</td><td></td></tr><tr><td>GDD_SERVICE_DISCOVERY_MODE</td><td>service discovery mode, available options: <code>memberlist</code> and <code>nacos</code></td><td>memberlist</td><td></td></tr><tr><td>GDD_ENABLE_RESPONSE_GZIP</td><td>enable http response gzip compression</td><td>true</td><td></td></tr></tbody></table><h2 id="memberlist-configuration" tabindex="-1"><a class="header-anchor" href="#memberlist-configuration" aria-hidden="true">#</a> Memberlist Configuration</h2><p>Red asterisk marked configuration can be dynamically changed in runtime by go-doudou listening to change events from remote configuration center. These configuration can be used to adjust gossip message convergence speed, in other words, how fast service list cached in each service instance memory become consistent.</p><table><thead><tr><th>Environment Variable</th><th>Description</th><th>Default</th><th>Required</th></tr></thead><tbody><tr><td>GDD_MEM_SEED</td><td>seed address for join memberlist cluster. If empty or not set, this node will create a new cluster for other nodes to join</td><td></td><td></td></tr><tr><td>GDD_MEM_NAME</td><td>for dev and test purpose only. unique name of this node in cluster. if empty or not set, hostname will be used instead</td><td></td><td></td></tr><tr><td>GDD_MEM_HOST</td><td>specify <code>AdvertiseAddr</code> attribute of memberlist config struct. if GDD_MEM_HOST starts with dot such as <code>.seed-svc-headless.default.svc.cluster.local</code>, it will be prefixed with <code>hostname</code> to be <code>seed-2.seed-svc-headless.default.svc.cluster.local</code> for supporting k8s statefulset service. By default, private ip is used</td><td></td><td></td></tr><tr><td>GDD_MEM_PORT</td><td>TCP and UDP port for memberlist instance to listen on</td><td>7946</td><td></td></tr><tr><td><span style="color:red;font-weight:bold;">*</span>GDD_MEM_DEAD_TIMEOUT</td><td>dead node will be removed from node map if not received refute messages from it in GDD_MEM_DEAD_TIMEOUT duration</td><td>60s</td><td></td></tr><tr><td><span style="color:red;font-weight:bold;">*</span>GDD_MEM_SYNC_INTERVAL</td><td>local node will synchronize states from other random node every GDD_MEM_SYNC_INTERVAL duration</td><td>60s</td><td></td></tr><tr><td><span style="color:red;font-weight:bold;">*</span>GDD_MEM_RECLAIM_TIMEOUT</td><td>dead node will be replaced with new node with the same name but different full address in GDD_MEM_RECLAIM_TIMEOUT duration</td><td>3s</td><td></td></tr><tr><td><span style="color:red;font-weight:bold;">*</span>GDD_MEM_PROBE_INTERVAL</td><td>ping remote nodes for failure detection every GDD_MEM_PROBE_INTERVAL duration</td><td>5s</td><td></td></tr><tr><td><span style="color:red;font-weight:bold;">*</span>GDD_MEM_PROBE_TIMEOUT</td><td>probe fail if not receive ack message in GDD_MEM_PROBE_TIMEOUT duration</td><td>3s</td><td></td></tr><tr><td><span style="color:red;font-weight:bold;">*</span>GDD_MEM_SUSPICION_MULT</td><td>The multiplier for determining the time an inaccessible node is considered suspect before declaring it dead</td><td>6</td><td></td></tr><tr><td><span style="color:red;font-weight:bold;">*</span>GDD_MEM_RETRANSMIT_MULT</td><td>The multiplier for the number of retransmissions that are attempted for messages broadcasted over gossip</td><td>4</td><td></td></tr><tr><td><span style="color:red;font-weight:bold;">*</span>GDD_MEM_GOSSIP_NODES</td><td>how many remote nodes you want to send gossip messages</td><td>4</td><td></td></tr><tr><td><span style="color:red;font-weight:bold;">*</span>GDD_MEM_GOSSIP_INTERVAL</td><td>gossip messages in queue every GDD_MEM_GOSSIP_INTERVAL duration</td><td>500ms</td><td></td></tr><tr><td><span style="color:red;font-weight:bold;">*</span>GDD_MEM_INDIRECT_CHECKS</td><td>the number of nodes that will be asked to perform an indirect probe of a node in the case a direct probe fails</td><td>3</td><td></td></tr><tr><td>GDD_MEM_TCP_TIMEOUT</td><td>TCP request will timeout in GDD_MEM_TCP_TIMEOUT duration</td><td>30s</td><td></td></tr><tr><td>GDD_MEM_WEIGHT</td><td><code>Deprecated</code> node weight for smooth weighted round-robin balancing</td><td>0</td><td></td></tr><tr><td>GDD_MEM_WEIGHT_INTERVAL</td><td>node weight will be calculated every GDD_MEM_WEIGHT_INTERVAL</td><td>0s</td><td></td></tr><tr><td>GDD_MEM_LOG_DISABLE</td><td>whether disable memberlist logging</td><td>false</td><td></td></tr><tr><td>GDD_MEM_CIDRS_ALLOWED</td><td>If not set, allow any connection (default), otherwise specify all networks allowed connecting (you must specify IPv6/IPv4 separately). Example: GDD_MEM_CIDRS_ALLOWED=172.28.0.0/16</td><td></td><td></td></tr></tbody></table><h2 id="nacos-configuration" tabindex="-1"><a class="header-anchor" href="#nacos-configuration" aria-hidden="true">#</a> Nacos Configuration</h2><table><thead><tr><th>Environment Variable</th><th>Description</th><th>Default</th><th>Required</th></tr></thead><tbody><tr><td>GDD_NACOS_NAMESPACE_ID</td><td>the namespaceId of Nacos</td><td>public</td><td></td></tr><tr><td>GDD_NACOS_TIMEOUT_MS</td><td>timeout for requesting Nacos server in milliseconds</td><td>10000</td><td></td></tr><tr><td>GDD_NACOS_NOT_LOAD_CACHE_AT_START</td><td>not to load persistent nacos service info in CacheDir at start time</td><td>false</td><td></td></tr><tr><td>GDD_NACOS_LOG_DIR</td><td>the directory for log</td><td>/tmp/nacos/log</td><td></td></tr><tr><td>GDD_NACOS_CACHE_DIR</td><td>the directory for persist nacos service info</td><td>/tmp/nacos/cache</td><td></td></tr><tr><td>GDD_NACOS_LOG_LEVEL</td><td>the level of log, it&#39;s must be <code>debug</code>,<code>info</code>,<code>warn</code>,<code>error</code></td><td>info</td><td></td></tr><tr><td>GDD_NACOS_SERVER_ADDR</td><td>nacos server connection url, multiple urls are joined by comma</td><td></td><td></td></tr><tr><td>GDD_NACOS_REGISTER_HOST</td><td>service instance host to be registered to nacos server, if not set, private ip is used by default</td><td></td><td></td></tr><tr><td>GDD_NACOS_CONFIG_FORMAT</td><td>configuration data format, options: <code>dotenv</code>, <code>yaml</code></td><td>dotenv</td><td></td></tr><tr><td>GDD_NACOS_CONFIG_GROUP</td><td>configuration group</td><td>DEFAULT_GROUP</td><td></td></tr><tr><td>GDD_NACOS_CONFIG_DATAID</td><td>configuration dataId</td><td></td><td>Yes</td></tr></tbody></table><h2 id="apollo-configuration" tabindex="-1"><a class="header-anchor" href="#apollo-configuration" aria-hidden="true">#</a> Apollo Configuration</h2><table><thead><tr><th>Environment Variable</th><th>Description</th><th>Default</th><th>Required</th></tr></thead><tbody><tr><td>GDD_APOLLO_CLUSTER</td><td>apollo cluster</td><td>default</td><td></td></tr><tr><td>GDD_APOLLO_ADDR</td><td>apollo config service address</td><td></td><td>Yes</td></tr><tr><td>GDD_APOLLO_NAMESPACE</td><td>apollo namespace</td><td>application.properties</td><td></td></tr><tr><td>GDD_APOLLO_BACKUP_ENABLE</td><td>enable local disk cache of configuration</td><td>true</td><td></td></tr><tr><td>GDD_APOLLO_BACKUP_PATH</td><td>the directory for local disk cache of configuration</td><td></td><td></td></tr><tr><td>GDD_APOLLO_MUSTSTART</td><td>if failed to connect to apollo config service, return error immediately</td><td>false</td><td></td></tr><tr><td>GDD_APOLLO_SECRET</td><td>apollo configuration secret</td><td></td><td></td></tr><tr><td>GDD_APOLLO_LOG_ENABLE</td><td>enable print apollo log</td><td>false</td><td></td></tr></tbody></table><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/unionj-cloud/go-doudou/edit/main/guide/configuration.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub"><!--[--><!--]--> Edit this page on GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/guide/rest.html" class="" aria-label="RESTful"><!--[--><!--]--> RESTful <!--[--><!--]--></a></span><span class="next"><a href="/guide/deployment.html" class="" aria-label="Deployment"><!--[--><!--]--> Deployment <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.594cd40c.js" defer></script>
  </body>
</html>
