<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.35">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" type="image/x-icon" sizes="32x32" href="/favicon.ico"><script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?658d535852e4dcdd8f3934c1c3e87165";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script><meta name="keywords" content="go-doudou,Go语言微服务框架,golang,go-doudou微服务框架,RESTful,微服务,服务注册与发现,负载均衡,熔断限流,grpc,去中心化,golang microservice framework,golang orm,ORM工具,microservice,service discovery,load balancing,circuit breaker,rate limit,低代码平台"><meta name="description" content="go-doudou是一个go语言微服务框架。它同时支持开发单体应用。从定义Go语言接口开始，无须学习任何接口描述语言。内置基于SWIM gossip协议的服务注册与发现的机制，帮助你构建一个健壮的、可扩展的、去中心化的微服务集群。内置强大的代码生成器。"><title>go-doudou + langchaingo Microkernel Architecture RAG Large Language Model Knowledge Base Practice (Part 1) | go-doudou</title>
    <link rel="modulepreload" href="/assets/app.2025f35b.js"><link rel="modulepreload" href="/assets/plugin-mechanism.html.de532bdf.js"><link rel="modulepreload" href="/assets/plugin-mechanism.html.5d30499d.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/assets/style.993d40d8.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="Toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/logo.png" alt="go-doudou"><span class="site-name can-hide">go-doudou</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/guide/" class="" aria-label="Guide"><!--[--><!--]--> Guide <!--[--><!--]--></a></div><div class="navbar-item"><a href="/resources/" class="" aria-label="Resources"><!--[--><!--]--> Resources <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/" class="router-link-active" aria-label="Blog"><!--[--><!--]--> Blog <!--[--><!--]--></a></div><div class="navbar-item"><a href="/contribution/" class="" aria-label="Contribution"><!--[--><!--]--> Contribution <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/unionj-cloud/go-doudou/releases" rel="noopener noreferrer" target="_blank" aria-label="Release Notes"><!--[--><!--]--> Release Notes <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/zh/" class="" aria-label="中文"><!--[--><!--]--> 中文 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/blog/plugin-mechanism.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/blog/plugin-mechanism.html" class="" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/unionj-cloud/go-doudou" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="Toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/guide/" class="" aria-label="Guide"><!--[--><!--]--> Guide <!--[--><!--]--></a></div><div class="navbar-item"><a href="/resources/" class="" aria-label="Resources"><!--[--><!--]--> Resources <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/" class="router-link-active" aria-label="Blog"><!--[--><!--]--> Blog <!--[--><!--]--></a></div><div class="navbar-item"><a href="/contribution/" class="" aria-label="Contribution"><!--[--><!--]--> Contribution <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/unionj-cloud/go-doudou/releases" rel="noopener noreferrer" target="_blank" aria-label="Release Notes"><!--[--><!--]--> Release Notes <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/zh/" class="" aria-label="中文"><!--[--><!--]--> 中文 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/blog/plugin-mechanism.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/blog/plugin-mechanism.html" class="" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/unionj-cloud/go-doudou" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">go-doudou + langchaingo Microkernel Architecture RAG Large Language Model Knowledge Base Practice (Part 1) <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/plugin-mechanism.html#_1-what-are-plugin-mechanisms-and-microkernel-architecture" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. What are Plugin Mechanisms and Microkernel Architecture"><!--[--><!--]--> 1. What are Plugin Mechanisms and Microkernel Architecture <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/plugin-mechanism.html#_2-plugin-mechanism-in-go-doudou-framework" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. Plugin Mechanism in go-doudou Framework"><!--[--><!--]--> 2. Plugin Mechanism in go-doudou Framework <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/plugin-mechanism.html#_3-implementation-and-registration-of-plugins" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. Implementation and Registration of Plugins"><!--[--><!--]--> 3. Implementation and Registration of Plugins <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/plugin-mechanism.html#_4-communication-between-modules" class="router-link-active router-link-exact-active sidebar-item" aria-label="4. Communication Between Modules"><!--[--><!--]--> 4. Communication Between Modules <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/plugin-mechanism.html#_5-modular-design-practices" class="router-link-active router-link-exact-active sidebar-item" aria-label="5. Modular Design Practices"><!--[--><!--]--> 5. Modular Design Practices <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/plugin-mechanism.html#_6-practical-case-rag-chat-system" class="router-link-active router-link-exact-active sidebar-item" aria-label="6. Practical Case: RAG Chat System"><!--[--><!--]--> 6. Practical Case: RAG Chat System <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/plugin-mechanism.html#_7-system-startup-and-usage-examples" class="router-link-active router-link-exact-active sidebar-item" aria-label="7. System Startup and Usage Examples"><!--[--><!--]--> 7. System Startup and Usage Examples <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/plugin-mechanism.html#_7-1-starting-the-system" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.1 Starting the System"><!--[--><!--]--> 7.1 Starting the System <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/plugin-mechanism.html#_7-2-call-examples" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.2 Call Examples"><!--[--><!--]--> 7.2 Call Examples <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/plugin-mechanism.html#_7-3-knowledge-base-retrieval-failure-handling-mechanism" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.3 Knowledge Base Retrieval Failure Handling Mechanism"><!--[--><!--]--> 7.3 Knowledge Base Retrieval Failure Handling Mechanism <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog/plugin-mechanism.html#_8-summary-and-outlook" class="router-link-active router-link-exact-active sidebar-item" aria-label="8. Summary and Outlook"><!--[--><!--]--> 8. Summary and Outlook <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/plugin-mechanism.html#references" class="router-link-active router-link-exact-active sidebar-item" aria-label="References"><!--[--><!--]--> References <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="go-doudou-langchaingo-microkernel-architecture-rag-large-language-model-knowledge-base-practice-part-1" tabindex="-1"><a class="header-anchor" href="#go-doudou-langchaingo-microkernel-architecture-rag-large-language-model-knowledge-base-practice-part-1" aria-hidden="true">#</a> go-doudou + langchaingo Microkernel Architecture RAG Large Language Model Knowledge Base Practice (Part 1)</h1><p><img src="/assets/go-doudou_langchaingo.94532c93.png" alt="programming.jpg"> Photo by <a href="https://unsplash.com/@cgower?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Christopher Gower</a> on <a href="https://unsplash.com/photos/a-macbook-with-lines-of-code-on-its-screen-on-a-busy-desk-m_HRfLhgABo?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Unsplash</a></p><p>In modern microservice architecture design, modular and pluggable design patterns are increasingly favored by developers. go-doudou, as a domestic Go language microservice framework, provides excellent plugin mechanisms and modular architecture support. This article will explain in detail go-doudou&#39;s plugin mechanism and modular microkernel architecture implementation through a practical project based on RAG (Retrieval-Augmented Generation).</p><h2 id="_1-what-are-plugin-mechanisms-and-microkernel-architecture" tabindex="-1"><a class="header-anchor" href="#_1-what-are-plugin-mechanisms-and-microkernel-architecture" aria-hidden="true">#</a> 1. What are Plugin Mechanisms and Microkernel Architecture</h2><p>Microkernel Architecture, also known as Plugin Architecture, is a design pattern that separates core system functions from extension functions. In this architecture:</p><ul><li><strong>Core System</strong>: Provides basic services and mechanisms for managing plugins</li><li><strong>Plugin Modules</strong>: Independently developed, independently deployed, implementing specific functions</li></ul><p>The advantages of this architecture include:</p><ol><li><strong>Highly Modular</strong>: Each plugin is an independent functional unit</li><li><strong>Strong Extensibility</strong>: New functions can be added without modifying the core system</li><li><strong>Low Coupling</strong>: Modules communicate through well-defined interfaces</li><li><strong>Flexible Deployment</strong>: Plugins can be loaded as needed</li></ol><h2 id="_2-plugin-mechanism-in-go-doudou-framework" tabindex="-1"><a class="header-anchor" href="#_2-plugin-mechanism-in-go-doudou-framework" aria-hidden="true">#</a> 2. Plugin Mechanism in go-doudou Framework</h2><p>The go-doudou framework supports plugin mechanisms by implementing the <code>ServicePlugin</code> interface. Each service module is registered to the main application as a plugin, achieving decoupling between modules and the core system.</p><p>Let&#39;s first look at the core code in <code>main/cmd/main.go</code> of this project:</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">package</span><span style="color:#D4D4D4;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">import</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;go-doudou-rag/toolkit/auth&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;github.com/unionj-cloud/go-doudou/v2/framework/grpcx&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;github.com/unionj-cloud/go-doudou/v2/framework/plugin&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;github.com/unionj-cloud/go-doudou/v2/framework/rest&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;github.com/unionj-cloud/toolkit/pipeconn&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;github.com/unionj-cloud/toolkit/zlogger&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;google.golang.org/grpc&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	_ </span><span style="color:#CE9178;">&quot;go-doudou-rag/module-auth/plugin&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	_ </span><span style="color:#CE9178;">&quot;go-doudou-rag/module-chat/plugin&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	_ </span><span style="color:#CE9178;">&quot;go-doudou-rag/module-knowledge/plugin&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Use</span><span style="color:#D4D4D4;">(auth.Jwt)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">grpcServer</span><span style="color:#D4D4D4;"> := grpcx.</span><span style="color:#DCDCAA;">NewGrpcServer</span><span style="color:#D4D4D4;">(</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#6A9955;">// GRPC configuration...</span></span>
<span class="line"><span style="color:#D4D4D4;">	)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">lis</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">dialCtx</span><span style="color:#D4D4D4;"> := pipeconn.</span><span style="color:#DCDCAA;">NewPipeListener</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">plugins</span><span style="color:#D4D4D4;"> := plugin.</span><span style="color:#DCDCAA;">GetServicePlugins</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">_</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;"> := </span><span style="color:#C586C0;">range</span><span style="color:#D4D4D4;"> plugins.</span><span style="color:#DCDCAA;">Keys</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">value</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">_</span><span style="color:#D4D4D4;"> := plugins.</span><span style="color:#DCDCAA;">Get</span><span style="color:#D4D4D4;">(key)</span></span>
<span class="line"><span style="color:#D4D4D4;">		value.</span><span style="color:#DCDCAA;">Initialize</span><span style="color:#D4D4D4;">(srv, grpcServer, dialCtx)</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">r</span><span style="color:#D4D4D4;"> := </span><span style="color:#DCDCAA;">recover</span><span style="color:#D4D4D4;">(); r != </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">			zlogger.</span><span style="color:#DCDCAA;">Info</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">Msgf</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Recovered. Error: </span><span style="color:#9CDCFE;">%v</span><span style="color:#D7BA7D;">\n</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">, r)</span></span>
<span class="line"><span style="color:#D4D4D4;">		}</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">_</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;"> := </span><span style="color:#C586C0;">range</span><span style="color:#D4D4D4;"> plugins.</span><span style="color:#DCDCAA;">Keys</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#9CDCFE;">value</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">_</span><span style="color:#D4D4D4;"> := plugins.</span><span style="color:#DCDCAA;">Get</span><span style="color:#D4D4D4;">(key)</span></span>
<span class="line"><span style="color:#D4D4D4;">			value.</span><span style="color:#DCDCAA;">Close</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">		}</span></span>
<span class="line"><span style="color:#D4D4D4;">	}()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">go</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">		grpcServer.</span><span style="color:#DCDCAA;">RunWithPipe</span><span style="color:#D4D4D4;">(lis)</span></span>
<span class="line"><span style="color:#D4D4D4;">	}()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoutes</span><span style="color:#D4D4D4;">(rest.</span><span style="color:#DCDCAA;">DocRoutes</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;">))</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>This code demonstrates the implementation of go-doudou&#39;s microkernel architecture:</p><ol><li>Anonymous import (<code>_ &quot;go-doudou-rag/module-xxx/plugin&quot;</code>) of each module&#39;s plugin package</li><li>Get all registered service plugins <code>plugin.GetServicePlugins()</code></li><li>Call the <code>Initialize</code> method of each plugin, passing in the REST server and gRPC server</li><li>Register resource cleanup functions, ensuring that the plugin&#39;s <code>Close</code> method is called when the program exits</li></ol><h2 id="_3-implementation-and-registration-of-plugins" tabindex="-1"><a class="header-anchor" href="#_3-implementation-and-registration-of-plugins" aria-hidden="true">#</a> 3. Implementation and Registration of Plugins</h2><p>Each module becomes a plugin by implementing the <code>ServicePlugin</code> interface. Taking the <code>module-auth</code> module as an example:</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">package</span><span style="color:#D4D4D4;"> plugin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">import</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;github.com/glebarez/sqlite&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;github.com/unionj-cloud/go-doudou/v2/framework/grpcx&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;github.com/unionj-cloud/go-doudou/v2/framework/plugin&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;github.com/unionj-cloud/go-doudou/v2/framework/rest&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;github.com/unionj-cloud/toolkit/pipeconn&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;github.com/unionj-cloud/toolkit/stringutils&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	service </span><span style="color:#CE9178;">&quot;go-doudou-rag/module-auth&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;go-doudou-rag/module-auth/config&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;go-doudou-rag/module-auth/internal/dao&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;go-doudou-rag/module-auth/internal/model&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;go-doudou-rag/module-auth/transport/httpsrv&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;google.golang.org/grpc&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;gorm.io/gorm&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;os&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">var</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">_</span><span style="color:#D4D4D4;"> plugin.ServicePlugin = (*ModuleAuthPlugin)(</span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">type</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">ModuleAuthPlugin</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">struct</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">	grpcConns []*grpc.ClientConn</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> (receiver *ModuleAuthPlugin) </span><span style="color:#DCDCAA;">Close</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">_</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">item</span><span style="color:#D4D4D4;"> := </span><span style="color:#C586C0;">range</span><span style="color:#D4D4D4;"> receiver.grpcConns {</span></span>
<span class="line"><span style="color:#D4D4D4;">		item.</span><span style="color:#DCDCAA;">Close</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> (receiver *ModuleAuthPlugin) </span><span style="color:#DCDCAA;">GoDoudouServicePlugin</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> (receiver *ModuleAuthPlugin) </span><span style="color:#DCDCAA;">GetName</span><span style="color:#D4D4D4;">() </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;"> := os.</span><span style="color:#DCDCAA;">Getenv</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;GDD_SERVICE_NAME&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> stringutils.</span><span style="color:#DCDCAA;">IsEmpty</span><span style="color:#D4D4D4;">(name) {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;cloud.unionj.ModuleAuth&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> name</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> (receiver *ModuleAuthPlugin) </span><span style="color:#DCDCAA;">Initialize</span><span style="color:#D4D4D4;">(restServer *rest.RestServer, grpcServer *grpcx.GrpcServer, dialCtx pipeconn.DialContextFunc) {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">conf</span><span style="color:#D4D4D4;"> := config.</span><span style="color:#DCDCAA;">LoadFromEnv</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">db</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">err</span><span style="color:#D4D4D4;"> := gorm.</span><span style="color:#DCDCAA;">Open</span><span style="color:#D4D4D4;">(sqlite.</span><span style="color:#DCDCAA;">Open</span><span style="color:#D4D4D4;">(conf.Db.Dsn), &amp;gorm.Config{})</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> err != </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#DCDCAA;">panic</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;failed to connect database&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">err</span><span style="color:#D4D4D4;"> = db.</span><span style="color:#DCDCAA;">AutoMigrate</span><span style="color:#D4D4D4;">(&amp;model.User{}); err != </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#DCDCAA;">panic</span><span style="color:#D4D4D4;">(err)</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	dao.</span><span style="color:#DCDCAA;">Use</span><span style="color:#D4D4D4;">(db)</span></span>
<span class="line"><span style="color:#D4D4D4;">	dao.</span><span style="color:#DCDCAA;">Init</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewModuleAuth</span><span style="color:#D4D4D4;">(conf)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">routes</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">NewModuleAuthHandler</span><span style="color:#D4D4D4;">(svc))</span></span>
<span class="line"><span style="color:#D4D4D4;">	restServer.</span><span style="color:#DCDCAA;">GroupRoutes</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;/moduleauth&quot;</span><span style="color:#D4D4D4;">, routes)</span></span>
<span class="line"><span style="color:#D4D4D4;">	restServer.</span><span style="color:#DCDCAA;">GroupRoutes</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;/moduleauth&quot;</span><span style="color:#D4D4D4;">, rest.</span><span style="color:#DCDCAA;">DocRoutes</span><span style="color:#D4D4D4;">(service.Oas))</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">init</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	plugin.</span><span style="color:#DCDCAA;">RegisterServicePlugin</span><span style="color:#D4D4D4;">(&amp;ModuleAuthPlugin{})</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><p>This plugin implements key interface methods:</p><ul><li><code>GoDoudouServicePlugin()</code>: Identifier interface method</li><li><code>GetName()</code>: Returns the plugin name</li><li><code>Initialize()</code>: Initializes the plugin, registers HTTP routes</li><li><code>Close()</code>: Releases resources</li></ul><p>Note especially the <code>plugin.RegisterServicePlugin()</code> in the <code>init()</code> function, which registers the plugin to the global plugin registry, allowing the main application to discover and load this plugin.</p><h2 id="_4-communication-between-modules" tabindex="-1"><a class="header-anchor" href="#_4-communication-between-modules" aria-hidden="true">#</a> 4. Communication Between Modules</h2><p>In microkernel architecture, communication between modules is a key challenge. go-doudou provides multiple communication methods:</p><ol><li><strong>Direct Dependency Call</strong>: Modules can directly import interfaces from other modules</li><li><strong>Dependency Injection</strong>: Implement dependency injection through the <code>samber/do</code> library</li></ol><p>In the implementation of <code>module-chat</code>, we can see how to call the service of <code>module-knowledge</code>:</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> (receiver *ModuleChatImpl) </span><span style="color:#DCDCAA;">Chat</span><span style="color:#D4D4D4;">(ctx context.Context, req dto.ChatRequest) (err </span><span style="color:#4EC9B0;">error</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#6A9955;">// ...code omitted...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">knowService</span><span style="color:#D4D4D4;"> := do.MustInvoke[know.ModuleKnowledge](</span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">queryResults</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">err</span><span style="color:#D4D4D4;"> := knowService.</span><span style="color:#DCDCAA;">GetQuery</span><span style="color:#D4D4D4;">(ctx, kdto.QueryReq{</span></span>
<span class="line"><span style="color:#D4D4D4;">		Text: req.Prompt,</span></span>
<span class="line"><span style="color:#D4D4D4;">		Top:  </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#6A9955;">// ...code omitted...</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>module-knowledge</code> registers services through dependency injection:</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">init</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	plugin.</span><span style="color:#DCDCAA;">RegisterServicePlugin</span><span style="color:#D4D4D4;">(&amp;ModuleKnowledgePlugin{})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	do.Provide[service.ModuleKnowledge](</span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(injector *do.Injector) (service.ModuleKnowledge, </span><span style="color:#4EC9B0;">error</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">conf</span><span style="color:#D4D4D4;"> := config.</span><span style="color:#DCDCAA;">LoadFromEnv</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">db</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">err</span><span style="color:#D4D4D4;"> := gorm.</span><span style="color:#DCDCAA;">Open</span><span style="color:#D4D4D4;">(sqlite.</span><span style="color:#DCDCAA;">Open</span><span style="color:#D4D4D4;">(conf.Db.Dsn), &amp;gorm.Config{})</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> err != </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#DCDCAA;">panic</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;failed to connect database&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">err</span><span style="color:#D4D4D4;"> = db.</span><span style="color:#DCDCAA;">AutoMigrate</span><span style="color:#D4D4D4;">(&amp;model.File{}); err != </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#DCDCAA;">panic</span><span style="color:#D4D4D4;">(err)</span></span>
<span class="line"><span style="color:#D4D4D4;">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">		dao.</span><span style="color:#DCDCAA;">Use</span><span style="color:#D4D4D4;">(db)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewModuleKnowledge</span><span style="color:#D4D4D4;">(conf)</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> svc, </span><span style="color:#569CD6;">nil</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="_5-modular-design-practices" tabindex="-1"><a class="header-anchor" href="#_5-modular-design-practices" aria-hidden="true">#</a> 5. Modular Design Practices</h2><p>This project demonstrates best practices in modular design, with each module having a clear division of responsibilities:</p><ol><li><strong>Module-Auth</strong>: Responsible for user authentication</li><li><strong>Module-Chat</strong>: Implements chat functionality, integrates large language models</li><li><strong>Module-Knowledge</strong>: Knowledge base management, implements RAG retrieval</li></ol><p>Each module follows a similar internal structure:</p><div class="language-text ext-text line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">module-xxx/
  ├── cmd/              # Independent execution entry point
  ├── config/           # Module configuration
  ├── dto/              # Data Transfer Objects
  ├── internal/         # Internal implementation
  │   ├── dao/          # Data access
  │   └── model/        # Data models
  ├── plugin/           # Plugin implementation
  ├── transport/        # Transport layer
  │   └── httpsrv/      # HTTP service
  ├── svc.go            # Service interface definition
  └── svcimpl.go        # Service implementation
</span></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>This structure ensures:</p><ol><li>Separation of interface and implementation</li><li>Separation of concerns</li><li>Clear dependency relationships</li><li>Good encapsulation</li></ol><h2 id="_6-practical-case-rag-chat-system" tabindex="-1"><a class="header-anchor" href="#_6-practical-case-rag-chat-system" aria-hidden="true">#</a> 6. Practical Case: RAG Chat System</h2><p>This project implements a chat system based on RAG (Retrieval-Augmented Generation), with the overall process as follows:</p><ol><li>Users authenticate through <code>module-auth</code></li><li>After authentication, they can upload knowledge documents through <code>module-knowledge</code></li><li>Users ask questions through <code>module-chat</code>, the system will: <ul><li>Retrieve relevant content from <code>module-knowledge</code></li><li>Call a large language model to generate answers</li><li>Return results via SSE (Server-Sent Events) streaming</li></ul></li></ol><p>For example, the core processing logic in <code>module-chat</code>:</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> (receiver *ModuleChatImpl) </span><span style="color:#DCDCAA;">Chat</span><span style="color:#D4D4D4;">(ctx context.Context, req dto.ChatRequest) (err </span><span style="color:#4EC9B0;">error</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#6A9955;">// ...set response headers...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#6A9955;">// Create LLM client</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">llm</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">err</span><span style="color:#D4D4D4;"> := openai.</span><span style="color:#DCDCAA;">New</span><span style="color:#D4D4D4;">(</span></span>
<span class="line"><span style="color:#D4D4D4;">		openai.</span><span style="color:#DCDCAA;">WithBaseURL</span><span style="color:#D4D4D4;">(receiver.conf.Openai.BaseUrl),</span></span>
<span class="line"><span style="color:#D4D4D4;">		openai.</span><span style="color:#DCDCAA;">WithToken</span><span style="color:#D4D4D4;">(lo.</span><span style="color:#DCDCAA;">Ternary</span><span style="color:#D4D4D4;">(stringutils.</span><span style="color:#DCDCAA;">IsNotEmpty</span><span style="color:#D4D4D4;">(receiver.conf.Openai.Token), </span></span>
<span class="line"><span style="color:#D4D4D4;">			receiver.conf.Openai.Token, os.</span><span style="color:#DCDCAA;">Getenv</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;OPENAI_API_KEY&quot;</span><span style="color:#D4D4D4;">))),</span></span>
<span class="line"><span style="color:#D4D4D4;">		openai.</span><span style="color:#DCDCAA;">WithEmbeddingModel</span><span style="color:#D4D4D4;">(receiver.conf.Openai.EmbeddingModel),</span></span>
<span class="line"><span style="color:#D4D4D4;">		openai.</span><span style="color:#DCDCAA;">WithModel</span><span style="color:#D4D4D4;">(receiver.conf.Openai.Model),</span></span>
<span class="line"><span style="color:#D4D4D4;">	)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#6A9955;">// Retrieve relevant content from knowledge base</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">knowService</span><span style="color:#D4D4D4;"> := do.MustInvoke[know.ModuleKnowledge](</span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">queryResults</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">err</span><span style="color:#D4D4D4;"> := knowService.</span><span style="color:#DCDCAA;">GetQuery</span><span style="color:#D4D4D4;">(ctx, kdto.QueryReq{</span></span>
<span class="line"><span style="color:#D4D4D4;">		Text: req.Prompt,</span></span>
<span class="line"><span style="color:#D4D4D4;">		Top:  </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#6A9955;">// Filter results with high relevance</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">queryResults</span><span style="color:#D4D4D4;"> = lo.</span><span style="color:#DCDCAA;">Filter</span><span style="color:#D4D4D4;">(queryResults, </span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(item kdto.QueryResult, index </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">) </span><span style="color:#4EC9B0;">bool</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> cast.</span><span style="color:#DCDCAA;">ToFloat64</span><span style="color:#D4D4D4;">(item.Similarity) &gt;= </span><span style="color:#B5CEA8;">0.5</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#6A9955;">// Build prompt</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">prompt</span><span style="color:#D4D4D4;"> := </span><span style="color:#CE9178;">&quot;Please answer the question based on the context information given below...&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#6A9955;">// Call LLM to generate answers and return them via streaming</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">content</span><span style="color:#D4D4D4;"> := []llms.MessageContent{</span></span>
<span class="line"><span style="color:#D4D4D4;">		llms.</span><span style="color:#DCDCAA;">TextParts</span><span style="color:#D4D4D4;">(llms.ChatMessageTypeSystem, </span><span style="color:#CE9178;">&quot;You are a senior public policy researcher.&quot;</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">		llms.</span><span style="color:#DCDCAA;">TextParts</span><span style="color:#D4D4D4;">(llms.ChatMessageTypeHuman, prompt),</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">_</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">err</span><span style="color:#D4D4D4;"> = llm.</span><span style="color:#DCDCAA;">GenerateContent</span><span style="color:#D4D4D4;">(ctx, content,</span></span>
<span class="line"><span style="color:#D4D4D4;">		llms.</span><span style="color:#DCDCAA;">WithMaxTokens</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">4096</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">		llms.</span><span style="color:#DCDCAA;">WithTemperature</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0.2</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">		llms.</span><span style="color:#DCDCAA;">WithStreamingFunc</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(ctx context.Context, chunk []</span><span style="color:#4EC9B0;">byte</span><span style="color:#D4D4D4;">) </span><span style="color:#4EC9B0;">error</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#9CDCFE;">chunkResp</span><span style="color:#D4D4D4;"> := dto.ChatResponse{</span></span>
<span class="line"><span style="color:#D4D4D4;">				Content:   </span><span style="color:#DCDCAA;">string</span><span style="color:#D4D4D4;">(chunk),</span></span>
<span class="line"><span style="color:#D4D4D4;">				RequestID: requestID,</span></span>
<span class="line"><span style="color:#D4D4D4;">				Type:      </span><span style="color:#CE9178;">&quot;content&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">			}</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">writeSSEMessage</span><span style="color:#D4D4D4;">(w, flusher, chunkResp)</span></span>
<span class="line"><span style="color:#D4D4D4;">		}))</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><h2 id="_7-system-startup-and-usage-examples" tabindex="-1"><a class="header-anchor" href="#_7-system-startup-and-usage-examples" aria-hidden="true">#</a> 7. System Startup and Usage Examples</h2><h3 id="_7-1-starting-the-system" tabindex="-1"><a class="header-anchor" href="#_7-1-starting-the-system" aria-hidden="true">#</a> 7.1 Starting the System</h3><p>Start this RAG system based on go-doudou plugin architecture with the following steps:</p><ol><li><p><strong>Clone the repository and enter the project directory</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">git clone https://github.com/your-repo/go-doudou-rag.git</span></span>
<span class="line"><span style="color:#DCDCAA;">cd</span><span style="color:#D4D4D4;"> go-doudou-rag</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p><strong>Install dependencies</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">go mod tidy</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li><li><p><strong>Start the main application</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#DCDCAA;">cd</span><span style="color:#D4D4D4;"> main/cmd</span></span>
<span class="line"><span style="color:#D4D4D4;">go run main.go</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol><p>After the system starts, all modules (auth, chat, knowledge) will be loaded as plugins, and their API endpoints will be registered to the main application.</p><h3 id="_7-2-call-examples" tabindex="-1"><a class="header-anchor" href="#_7-2-call-examples" aria-hidden="true">#</a> 7.2 Call Examples</h3><p>The following shows how to use curl commands to send requests to the chat service for knowledge-based Q&amp;A:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;"># Login</span></span>
<span class="line"><span style="color:#D4D4D4;">curl --location </span><span style="color:#CE9178;">&#39;http://localhost:6060/moduleauth/login&#39;</span><span style="color:#D4D4D4;"> \</span></span>
<span class="line"><span style="color:#D4D4D4;">--header </span><span style="color:#CE9178;">&#39;Content-Type: application/json&#39;</span><span style="color:#D4D4D4;"> \</span></span>
<span class="line"><span style="color:#D4D4D4;">--data </span><span style="color:#CE9178;">&#39;{</span></span>
<span class="line"><span style="color:#CE9178;">    &quot;username&quot;: &quot;admin&quot;,</span></span>
<span class="line"><span style="color:#CE9178;">    &quot;password&quot;: &quot;admin&quot;</span></span>
<span class="line"><span style="color:#CE9178;">}&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># Upload PDF document</span></span>
<span class="line"><span style="color:#D4D4D4;">curl --location </span><span style="color:#CE9178;">&#39;http://localhost:6060/moduleknowledge/upload&#39;</span><span style="color:#D4D4D4;"> \</span></span>
<span class="line"><span style="color:#D4D4D4;">--header </span><span style="color:#CE9178;">&#39;Authorization: Bearer &lt;token obtained from login interface&gt;&#39;</span><span style="color:#D4D4D4;"> \</span></span>
<span class="line"><span style="color:#D4D4D4;">--form </span><span style="color:#CE9178;">&#39;file=@&quot;/Users/wubin1989/Downloads/杭州市人民政府印发关于进一步推动经济高质量发展若干政策的通知.pdf&quot;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># Chat</span></span>
<span class="line"><span style="color:#D4D4D4;">curl -w </span><span style="color:#CE9178;">&#39;\n&#39;</span><span style="color:#D4D4D4;"> -N -X POST </span><span style="color:#CE9178;">&#39;http://localhost:6060/modulechat/chat&#39;</span><span style="color:#D4D4D4;"> \</span></span>
<span class="line"><span style="color:#D4D4D4;">--header </span><span style="color:#CE9178;">&#39;Content-Type: application/json&#39;</span><span style="color:#D4D4D4;"> \</span></span>
<span class="line"><span style="color:#D4D4D4;">--header </span><span style="color:#CE9178;">&#39;Authorization: Bearer &lt;token obtained from login interface&gt;&#39;</span><span style="color:#D4D4D4;"> \</span></span>
<span class="line"><span style="color:#D4D4D4;">--data </span><span style="color:#CE9178;">&#39;{</span></span>
<span class="line"><span style="color:#CE9178;">    &quot;prompt&quot;: &quot;What recent economic policies has Hangzhou introduced?&quot;</span></span>
<span class="line"><span style="color:#CE9178;">}&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>System response example:</p><p>First, the system returns the constructed prompt (including context information retrieved from the knowledge base):</p><div class="language-text ext-text line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">Please answer the question based on the context information given below, the answer must be itemized for clarity. If you don&#39;t know, you can answer that you don&#39;t know, but don&#39;t make up answers:
1. — 1 —
Hangzhou Municipal People&#39;s Government Document
Hangzheng Function [2024] No. 16
Notice of Hangzhou Municipal People&#39;s Government on Issuing
Several Policies for Further Promoting High-Quality Economic Development
To all district, county (city) people&#39;s governments, municipal government departments, and directly affiliated units:
The &quot;Several Policies for Further Promoting High-Quality Economic Development&quot; is now issued to you, please organize implementation in conjunction with actual conditions.
Hangzhou Municipal People&#39;s Government
February 18, 2024
(This document is publicly released)
ZJAC00-2024-0001
2. — 2 —
Several Policies for Further Promoting High-Quality Economic Development
... [context partially omitted] ...
</span></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Then, the system generates a structured answer based on the retrieved context information:</p><div class="language-text ext-text line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">According to the provided information, the Hangzhou Municipal People&#39;s Government has recently issued a series of policies to promote high-quality economic development, specifically including the following aspects:

1. **Expanding Effective Investment Policies**: Promoting the introduction of the &quot;Hangzhou Municipal Government Investment Project Management Regulations&quot;, implementing the provincial &quot;Thousand Projects Trillion Yuan&quot; project for expanding effective investment, planning to complete investments of over 80 billion yuan in 2024, driving fixed asset investment growth by 3%.

2. **Stimulating Consumption Potential**: Implementing policies such as purchase tax exemptions for new energy vehicles, adding 3,000 charging facilities in public areas throughout the year, organizing over 500 consumption promotion activities, and holding more than 50 catering consumption promotion activities.

3. **Supporting High-Quality Enterprise Development**: Improving the gradient cultivation mechanism for quality enterprises, providing a one-time reward of up to 200,000 yuan for industrial enterprises that are first incorporated into statistics, and an additional one-time reward of up to 300,000 yuan for those that remain in the statistics for 3 consecutive years.

4. **Stabilizing Foreign Trade Development**: Organizing no less than 150 foreign trade groups throughout the year, participating in more than 100 overseas exhibitions, sending 3,000 enterprises to explore overseas markets, and increasing the upper limit of short-term export credit insurance premium subsidy ratio to 60% (upper limit increased to 65% for manufacturing enterprises).

5. **Building an International Exhibition City**: Successfully hosting the 3rd Global Digital Trade Expo with high quality, achieving five doublings, and attracting 30 exhibitions to settle in Hangzhou International Expo Center and Convention Center in 2024.

6. **Supporting Digital Trade Development**: Encouraging enterprises to conduct data export security assessments, participate in the formulation of various standards in the field of digital trade, and continuously promote innovation in service trade development.

7. **Leveraging E-commerce Advantages**: Promoting high-quality development of new e-commerce in Hangzhou, cumulatively building no less than 200 e-commerce live streaming &quot;Common Prosperity Workshops&quot; throughout the year, and deepening the construction of Hangzhou Cross-border E-commerce Comprehensive Pilot Zone.

8. **Strengthening Financial Support**: The municipal finance budget for 2024 allocates 600 million yuan to support expanding domestic demand and stimulating consumption, supporting foreign trade development, high-quality development of new e-commerce, cross-border e-commerce development, opening new international routes, etc.
</span></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_7-3-knowledge-base-retrieval-failure-handling-mechanism" tabindex="-1"><a class="header-anchor" href="#_7-3-knowledge-base-retrieval-failure-handling-mechanism" aria-hidden="true">#</a> 7.3 Knowledge Base Retrieval Failure Handling Mechanism</h3><p>An important feature of the RAG system is that it only answers questions based on information existing in the knowledge base. When a user&#39;s question has low or no relevance to documents in the knowledge base, the system will clearly inform the user that it cannot answer, rather than generating potentially inaccurate information. Here is an example:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">curl -w </span><span style="color:#CE9178;">&#39;\n&#39;</span><span style="color:#D4D4D4;"> -N -X POST </span><span style="color:#CE9178;">&#39;http://localhost:6060/modulechat/chat&#39;</span><span style="color:#D4D4D4;"> \</span></span>
<span class="line"><span style="color:#D4D4D4;">--header </span><span style="color:#CE9178;">&#39;Content-Type: application/json&#39;</span><span style="color:#D4D4D4;"> \</span></span>
<span class="line"><span style="color:#D4D4D4;">--header </span><span style="color:#CE9178;">&#39;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NDU4OTM4MTMsInVzZXJuYW1lIjoiYWRtaW4ifQ.EjxDfrMMHmOCvt557H8rd5sn9zX-uYOytw4OKH-jLJ8&#39;</span><span style="color:#D4D4D4;"> \</span></span>
<span class="line"><span style="color:#D4D4D4;">--data </span><span style="color:#CE9178;">&#39;{</span></span>
<span class="line"><span style="color:#CE9178;">    &quot;prompt&quot;: &quot;What is the latest version of Java?&quot;            </span></span>
<span class="line"><span style="color:#CE9178;">}&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>System response:</p><div class="language-text ext-text line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">I&#39;m very sorry, no relevant information could be retrieved, unable to answer
</span></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>In the code implementation, this mechanism is implemented as follows:</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">// Implementation from module-chat/svcimpl.go</span></span>
<span class="line"><span style="color:#9CDCFE;">queryResults</span><span style="color:#D4D4D4;"> = lo.</span><span style="color:#DCDCAA;">Filter</span><span style="color:#D4D4D4;">(queryResults, </span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(item kdto.QueryResult, index </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">) </span><span style="color:#4EC9B0;">bool</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> cast.</span><span style="color:#DCDCAA;">ToFloat64</span><span style="color:#D4D4D4;">(item.Similarity) &gt;= </span><span style="color:#B5CEA8;">0.5</span></span>
<span class="line"><span style="color:#D4D4D4;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">len</span><span style="color:#D4D4D4;">(queryResults) == </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    zlogger.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">Msgf</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Knowledge not found, requestId: </span><span style="color:#9CDCFE;">%s</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">, requestID)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">chunk</span><span style="color:#D4D4D4;"> := dto.ChatResponse{</span></span>
<span class="line"><span style="color:#D4D4D4;">        Content:   </span><span style="color:#CE9178;">&quot;I&#39;m very sorry, no relevant information could be retrieved, unable to answer&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">        RequestID: requestID,</span></span>
<span class="line"><span style="color:#D4D4D4;">        Type:      </span><span style="color:#CE9178;">&quot;error&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">writeSSEMessage</span><span style="color:#D4D4D4;">(w, flusher, chunk)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>This design ensures that the system only answers questions for which it has a knowledge base, improving the reliability and accuracy of responses and avoiding the risk of generating false information. It is an important aspect of responsible AI application design, especially in fields requiring high accuracy such as policy consulting, legal advice, etc.</p><p>This example fully demonstrates the power of plugin architecture:</p><ol><li><strong>Module Collaboration</strong>: <code>module-auth</code> handles authentication, <code>module-knowledge</code> is responsible for knowledge retrieval, and <code>module-chat</code> integrates large language models to generate answers</li><li><strong>Pluggability</strong>: Each module can be independently updated or replaced</li><li><strong>Technical Decoupling</strong>: Each module can use different technology stacks and data storage methods</li></ol><h2 id="_8-summary-and-outlook" tabindex="-1"><a class="header-anchor" href="#_8-summary-and-outlook" aria-hidden="true">#</a> 8. Summary and Outlook</h2><p>This article detailed the plugin mechanism and modular pluggable microkernel architecture in the go-doudou framework through a practical RAG chat system case. We have seen that this architectural pattern not only provides good modularity and extensibility but also allows different parts of the system to work together in a loosely coupled manner, greatly improving development efficiency and system maintainability.</p><p>The plugin mechanism in the go-doudou framework provides developers with a concise yet powerful way to build modular applications through the <code>ServicePlugin</code> interface and dependency injection system. This approach is particularly suitable for team collaborative development of complex systems, where each team can focus on their domain module without needing to be overly concerned with implementation details of other modules.</p><p>However, understanding concepts and principles is just the first step; how to actually build such a system from scratch is what developers care about most. In the next article, &quot;Plugin Mechanism in go-doudou Framework and Modular Pluggable Microkernel Architecture in Practice (Part 2)&quot;, we will provide a detailed practical guide, leading readers step by step to build a complete go-doudou microkernel architecture application from scratch. We will demonstrate how to use go-doudou CLI tools to create workspaces, define service interfaces, implement plugins, configure communication between modules, and other full-process operations through specific commands and code examples, helping developers quickly master the practical application methods of this powerful architectural pattern.</p><h2 id="references" tabindex="-1"><a class="header-anchor" href="#references" aria-hidden="true">#</a> References</h2><ul><li>go-doudou official documentation: https://go-doudou.github.io/</li><li>Source code of this project: https://github.com/wubin1989/go-doudou-rag</li></ul><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/unionj-cloud/go-doudou/edit/main/blog/plugin-mechanism.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub"><!--[--><!--]--> Edit this page on GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: wubinwill@gmail.com">武斌</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.2025f35b.js" defer></script>
  </body>
</html>
