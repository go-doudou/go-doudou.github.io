import{r as p,o as r,a as c,b as s,e as a,w as t,F as D,g as e,f as n}from"./app.2025f35b.js";import{_ as i}from"./elk.d2b0578e.js";import{_ as y,a as d}from"./jaeger2.579239e1.js";import{_ as u}from"./plugin-vue_export-helper.21dcd24c.js";const b={},C=e(`<h1 id="rest" tabindex="-1"><a class="header-anchor" href="#rest" aria-hidden="true">#</a> REST</h1><h2 id="\u5185\u7F6E\u8DEF\u7531\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#\u5185\u7F6E\u8DEF\u7531\u8BF4\u660E" aria-hidden="true">#</a> \u5185\u7F6E\u8DEF\u7531\u8BF4\u660E</h2><p>go-doudou\u6846\u67B6\u5185\u7F6E\u4E8612\u4E2A\u8DEF\u7531\uFF0C\u65B9\u4FBF\u670D\u52A1\u5F00\u53D1\u8005\u548C\u8C03\u7528\u8005\u8054\u8C03\uFF0C\u670D\u52A1\u5F00\u53D1\u8005\u5BF9\u670D\u52A1\u7684\u72B6\u6001\u8FDB\u884C\u76D1\u63A7\uFF0C\u4EE5\u53CA\u5BF9\u7EBF\u4E0A\u670D\u52A1\u8FDB\u884C\u8C03\u4F18\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetDoc               | GET    | /go-doudou/doc          |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetOpenAPI           | GET    | /go-doudou/openapi.json |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | Prometheus           | GET    | /go-doudou/prometheus   |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetConfig            | GET    | /go-doudou/config       |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetStatsvizWs        | GET    | /go-doudou/statsviz/ws  |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetStatsviz          | GET    | /go-doudou/statsviz/*   |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetDebugPprofCmdline | GET    | /debug/pprof/cmdline    |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetDebugPprofProfile | GET    | /debug/pprof/profile    |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetDebugPprofSymbol  | GET    | /debug/pprof/symbol     |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetDebugPprofTrace   | GET    | /debug/pprof/trace      |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetDebugPprofIndex   | GET    | /debug/pprof/*          |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF +----------------------+--------+-------------------------+</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF ===================================================</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF Http server is listening at :6060</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF Http server started </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> 1.676754ms      </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>\u4E0B\u9762\u4E00\u4E00\u8BF4\u660E\uFF1A</p>`,5),m=s("code",null,"/go-doudou/doc",-1),h=n("\uFF1A\u57FA\u4E8EOpenAPI 3.0\u89C4\u8303\uFF0C\u91C7\u7528vuejs+elementUI\u5F00\u53D1\u7684\u5728\u7EBF\u63A5\u53E3\u6587\u6863\u3002\u6838\u5FC3\u4EE3\u7801\u5DF2\u5F00\u6E90\uFF0C\u7F16\u8BD1\u540E\u53EF\u4EE5\u5355\u72EC\u4F7F\u7528\uFF0C\u7279\u522B\u662F\u53EF\u4EE5\u7528\u4E8E\u5176\u4ED6\u6846\u67B6\u548C\u7F16\u7A0B\u8BED\u8A00\uFF0C\u4ED3\u5E93\u5730\u5740\uFF1A"),A={href:"https://github.com/unionj-cloud/go-doudou-openapi-ui",target:"_blank",rel:"noopener noreferrer"},E=n("https://github.com/unionj-cloud/go-doudou-openapi-ui"),g=s("code",null,"/go-doudou/openapi.json",-1),v=n("\uFF1A\u517C\u5BB9OpenAPI 3.0\u89C4\u8303\u7684json\u6587\u6863\uFF0C\u4E3B\u8981\u7528\u4E8E\u540C\u6837\u662F\u652F\u6301OpenAPI 3.0\u7684\u7B2C\u4E09\u65B9\u4EE3\u7801\u751F\u6210\u5DE5\u5177\u751F\u6210\u4EE3\u7801\uFF0C\u6BD4\u5982go-doudou\u4F5C\u8005\u5F00\u6E90\u7684Nodejs\u5F00\u53D1\u7684\u652F\u6301typescript\u7684http\u8BF7\u6C42\u5BA2\u6237\u7AEF\u4EE3\u7801\u751F\u6210\u5668pullcode\uFF0C\u4ED3\u5E93\u5730\u5740\uFF1A"),_={href:"https://github.com/wubin1989/pullcode",target:"_blank",rel:"noopener noreferrer"},f=n("https://github.com/wubin1989/pullcode"),R=s("li",null,[s("p",null,[s("code",null,"/go-doudou/prometheus"),n("\uFF1A\u7528\u4E8EPrometheus\u722C\u53D6\u670D\u52A1\u8FD0\u884C\u6307\u6807")])],-1),k=s("li",null,[s("p",null,[s("code",null,"/go-doudou/config"),n("\uFF1A\u7528\u4E8E\u67E5\u770B\u5F53\u524D\u670D\u52A1\u8FD0\u884C\u4E2D\u751F\u6548\u7684\u73AF\u5883\u914D\u7F6E\uFF0C\u53EF\u4EE5\u52A0\u67E5\u8BE2\u5B57\u7B26\u4E32\u53C2\u6570"),s("code",null,"pre"),n("\uFF0C\u4F8B\u5982\uFF1A"),s("code",null,"http://localhost:6066/go-doudou/config?pre=GDD_"),n("\uFF0C\u8868\u793A\u53EA\u663E\u793A\u4EE5"),s("code",null,"GDD_"),n("\u4E3A\u524D\u7F00\u7684\u73AF\u5883\u53D8\u91CF")])],-1),q=s("code",null,"/go-doudou/statsviz/ws",-1),x=n("\u548C"),S=s("code",null,"/go-doudou/statsviz/*",-1),F=n("\uFF1A\u96C6\u6210\u4E86\u53EF\u89C6\u5316\u8FD0\u884C\u65F6\u7EDF\u8BA1\u6307\u6807\u7684\u5F00\u6E90\u5E93"),N={href:"https://github.com/arl/statsviz",target:"_blank",rel:"noopener noreferrer"},w=n("https://github.com/arl/statsviz"),G=s("li",null,[s("p",null,[s("code",null,"/debug/"),n("\u4E3A\u524D\u7F00\u7684\u8DEF\u7531\uFF1A\u96C6\u6210\u4E86go\u8BED\u8A00\u5185\u7F6E\u7684pprof\u5DE5\u5177\uFF0C\u9700\u8981\u4F18\u5316\u7A0B\u5E8F\u7684\u65F6\u5019\u53EF\u4EE5\u7528\uFF0C\u6709\u51E0\u79CD\u5E38\u7528\u7684\u7528\u6CD5\u9644\u5728\u4E0B\u65B9\uFF0C")])],-1),P=e(`<div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">go tool pprof -http :6068 http://admin:admin@localhost:6060/debug/pprof/profile</span><span style="color:#D7BA7D;">\\?</span><span style="color:#D4D4D4;">seconds</span><span style="color:#D7BA7D;">\\=</span><span style="color:#D4D4D4;">20</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u7B49\u5F8520\u79D2\u4EE5\u540E\uFF0C\u4F1A\u81EA\u52A8\u6253\u5F00\u6D4F\u89C8\u5668\uFF0C\u53EF\u4EE5\u67E5\u770B\u706B\u7130\u56FE\u7B49\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">curl -o trace.out http://qylz:1234@localhost:6060/debug/pprof/trace</span><span style="color:#D7BA7D;">\\?</span><span style="color:#D4D4D4;">seconds</span><span style="color:#D7BA7D;">\\=</span><span style="color:#D4D4D4;">20</span></span>
<span class="line"><span style="color:#D4D4D4;">go tool trace trace.out</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u8FD9\u4E24\u4E2A\u547D\u4EE4\u6267\u884C\u5B8C\u4EE5\u540E\uFF0C\u4F1A\u81EA\u52A8\u6253\u5F00\u6D4F\u89C8\u5668\uFF0C\u4F60\u53EF\u4EE5\u67E5\u770B\u524D20s\u7684\u7A0B\u5E8F\u8FD0\u884C\u65F6\u7684\u76D1\u63A7\u6307\u6807\u3002</p><p>\u53E6\u5916\u9700\u8981\u8BF4\u660E\u7684\u662F\uFF1A\u6240\u6709\u7684\u5185\u7F6E\u8DEF\u7531\u90FD\u52A0\u4E86http basic auth\u6821\u9A8C\uFF0C\u4F60\u53EF\u4EE5\u5206\u522B\u901A\u8FC7\u73AF\u5883\u53D8\u91CF <code>GDD_MANAGE_USER</code> \u548C <code>GDD_MANAGE_PASS</code>\u81EA\u5B9A\u4E49\u914D\u7F6E\u7528\u6237\u540D\u548C\u5BC6\u7801\uFF0C\u9ED8\u8BA4\u503C\u90FD\u662F<code>admin</code>\u3002\u5982\u679C\u4F60\u91C7\u7528\u4E86go-doudou\u652F\u6301\u7684\u914D\u7F6E\u7BA1\u7406\u4E2D\u5FC3Nacos\u6216\u8005Apollo\uFF0C\u53EF\u4EE5\u5728\u8FD0\u884C\u65F6\u52A8\u6001\u4FEE\u6539\uFF0C\u81EA\u52A8\u751F\u6548\uFF0C\u65E0\u987B\u91CD\u542F\u670D\u52A1\u3002\u5EFA\u8BAE\u751F\u4EA7\u73AF\u5883\u7684\u670D\u52A1\u7684http basic\u7528\u6237\u540D\u548C\u5BC6\u7801\u9694\u6BB5\u65F6\u95F4\u6362\u4E00\u4E0B\uFF0C\u786E\u4FDD\u5B89\u5168\u3002</p><h2 id="\u670D\u52A1\u6CE8\u518C\u4E0E\u53D1\u73B0" tabindex="-1"><a class="header-anchor" href="#\u670D\u52A1\u6CE8\u518C\u4E0E\u53D1\u73B0" aria-hidden="true">#</a> \u670D\u52A1\u6CE8\u518C\u4E0E\u53D1\u73B0</h2><p><code>go-doudou</code>\u652F\u6301\u4E24\u79CD\u670D\u52A1\u6CE8\u518C\u4E0E\u53D1\u73B0\u673A\u5236\uFF1A<code>etcd</code>\u548C<code>nacos</code>\u3002REST\u670D\u52A1\u6CE8\u518C\u5728\u6CE8\u518C\u4E2D\u5FC3\u7684\u670D\u52A1\u540D\u79F0\u4F1A\u81EA\u52A8\u52A0\u4E0A <code>_rest</code> \u540E\u7F00\uFF0CgRPC\u670D\u52A1\u6CE8\u518C\u5728\u6CE8\u518C\u4E2D\u5FC3\u7684\u670D\u52A1\u540D\u79F0\u4F1A\u81EA\u52A8\u52A0\u4E0A <code>_grpc</code>\uFF0C\u4EE5\u4F5C\u533A\u5206\u3002</p><div class="custom-container tip"><p class="custom-container-title">\u63D0\u793A</p><p><code>etcd</code>\u548C<code>nacos</code>\u4E24\u79CD\u673A\u5236\u53EF\u4EE5\u5728\u4E00\u4E2A\u670D\u52A1\u4E2D\u540C\u65F6\u4F7F\u7528</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_DISCOVERY_MODE=etcd,nacos</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><h3 id="etcd" tabindex="-1"><a class="header-anchor" href="#etcd" aria-hidden="true">#</a> Etcd</h3><p><code>go-doudou</code>\u4ECEv2\u7248\u672C\u8D77\u5185\u5EFA\u652F\u6301\u4F7F\u7528etcd\u4F5C\u4E3A\u6CE8\u518C\u4E2D\u5FC3\uFF0C\u5B9E\u73B0\u670D\u52A1\u6CE8\u518C\u4E0E\u53D1\u73B0\u3002\u9700\u914D\u7F6E\u5982\u4E0B\u73AF\u5883\u53D8\u91CF:</p><ul><li><code>GDD_SERVICE_NAME</code>: \u670D\u52A1\u540D\u79F0\uFF0C\u5FC5\u987B</li><li><code>GDD_SERVICE_DISCOVERY_MODE</code>: \u670D\u52A1\u6CE8\u518C\u4E0E\u53D1\u73B0\u673A\u5236\u540D\u79F0\uFF0C<code>etcd</code>\uFF0C\u5FC5\u987B</li><li><code>GDD_ETCD_ENDPOINTS</code>: etcd\u8FDE\u63A5\u5730\u5740\uFF0C\u5FC5\u987B</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_NAME=grpcdemo-server</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_DISCOVERY_MODE=etcd</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_ETCD_ENDPOINTS=localhost:2379</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="nacos" tabindex="-1"><a class="header-anchor" href="#nacos" aria-hidden="true">#</a> Nacos</h3><p><code>go-doudou</code>\u5185\u5EFA\u652F\u6301\u4F7F\u7528\u963F\u91CC\u5F00\u53D1\u7684Nacos\u4F5C\u4E3A\u6CE8\u518C\u4E2D\u5FC3\uFF0C\u5B9E\u73B0\u670D\u52A1\u6CE8\u518C\u4E0E\u53D1\u73B0\u3002\u9700\u914D\u7F6E\u5982\u4E0B\u73AF\u5883\u53D8\u91CF:</p><ul><li><code>GDD_SERVICE_NAME</code>: \u670D\u52A1\u540D\u79F0\uFF0C\u5FC5\u987B</li><li><code>GDD_NACOS_SERVER_ADDR</code>: Nacos\u670D\u52A1\u7AEF\u5730\u5740\uFF0C\u5FC5\u987B</li><li><code>GDD_SERVICE_DISCOVERY_MODE</code>: \u670D\u52A1\u53D1\u73B0\u673A\u5236\u540D\u79F0\uFF0C\u5FC5\u987B</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_NAME=test-svc </span><span style="color:#6A9955;"># Required</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_NACOS_SERVER_ADDR=http://localhost:8848/nacos </span><span style="color:#6A9955;"># Required</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_DISCOVERY_MODE=nacos </span><span style="color:#6A9955;"># Required</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="zookeeper" tabindex="-1"><a class="header-anchor" href="#zookeeper" aria-hidden="true">#</a> Zookeeper</h3><p><code>go-doudou</code>\u5185\u5EFA\u652F\u6301\u4F7F\u7528Zookeeper\u4F5C\u4E3A\u6CE8\u518C\u4E2D\u5FC3\uFF0C\u5B9E\u73B0\u670D\u52A1\u6CE8\u518C\u4E0E\u53D1\u73B0\u3002\u9700\u914D\u7F6E\u5982\u4E0B\u73AF\u5883\u53D8\u91CF:</p><ul><li><code>GDD_SERVICE_NAME</code>: \u670D\u52A1\u540D\u79F0\uFF0C\u5FC5\u987B</li><li><code>GDD_SERVICE_DISCOVERY_MODE</code>: \u670D\u52A1\u53D1\u73B0\u673A\u5236\u540D\u79F0\uFF0C\u5FC5\u987B</li><li><code>GDD_ZK_SERVERS</code>: Nacos\u670D\u52A1\u7AEF\u5730\u5740\uFF0C\u5FC5\u987B</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_NAME=cloud.unionj.ServiceB </span><span style="color:#6A9955;"># Required</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_DISCOVERY_MODE=zk </span><span style="color:#6A9955;"># Required</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_ZK_SERVERS=localhost:2181 </span><span style="color:#6A9955;"># Required</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_ZK_DIRECTORY_PATTERN=/dubbo/%s/providers</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_GROUP=group</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_VERSION=v2.2.2</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="\u5BA2\u6237\u7AEF\u8D1F\u8F7D\u5747\u8861" tabindex="-1"><a class="header-anchor" href="#\u5BA2\u6237\u7AEF\u8D1F\u8F7D\u5747\u8861" aria-hidden="true">#</a> \u5BA2\u6237\u7AEF\u8D1F\u8F7D\u5747\u8861</h2><h3 id="\u7B80\u5355\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861-etcd\u7528" tabindex="-1"><a class="header-anchor" href="#\u7B80\u5355\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861-etcd\u7528" aria-hidden="true">#</a> \u7B80\u5355\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861 (Etcd\u7528)</h3><p>\u9700\u8C03\u7528 <code>etcd.NewRRServiceProvider(&quot;\u6CE8\u518C\u5728etcd\u4E2D\u7684\u670D\u52A1\u540D\u79F0&quot;)</code> \u521B\u5EFA <code>etcd.RRServiceProvider</code> \u5B9E\u4F8B\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> etcd.</span><span style="color:#DCDCAA;">CloseEtcdClient</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">conf</span><span style="color:#D4D4D4;"> := config.</span><span style="color:#DCDCAA;">LoadFromEnv</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">restProvider</span><span style="color:#D4D4D4;"> := etcd.</span><span style="color:#DCDCAA;">NewRRServiceProvider</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;grpcdemo-server_rest&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewEnumDemo</span><span style="color:#D4D4D4;">(conf, client.</span><span style="color:#DCDCAA;">NewHelloworldClient</span><span style="color:#D4D4D4;">(restclient.</span><span style="color:#DCDCAA;">WithProvider</span><span style="color:#D4D4D4;">(restProvider)))</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewEnumDemoHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="\u5E73\u6ED1\u52A0\u6743\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861-etcd\u7528" tabindex="-1"><a class="header-anchor" href="#\u5E73\u6ED1\u52A0\u6743\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861-etcd\u7528" aria-hidden="true">#</a> \u5E73\u6ED1\u52A0\u6743\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861 (Etcd\u7528)</h3><p>\u9700\u8C03\u7528 <code>etcd.NewSWRRServiceProvider(&quot;\u6CE8\u518C\u5728etcd\u4E2D\u7684\u670D\u52A1\u540D\u79F0&quot;)</code> \u521B\u5EFA <code>etcd.SWRRServiceProvider</code> \u5B9E\u4F8B\u3002</p><p>\u5982\u679C\u73AF\u5883\u53D8\u91CF<code>GDD_WEIGHT</code>\u90FD\u6CA1\u6709\u8BBE\u7F6E\uFF0C\u9ED8\u8BA4\u6743\u91CD\u662F1\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> etcd.</span><span style="color:#DCDCAA;">CloseEtcdClient</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">conf</span><span style="color:#D4D4D4;"> := config.</span><span style="color:#DCDCAA;">LoadFromEnv</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">restProvider</span><span style="color:#D4D4D4;"> := etcd.</span><span style="color:#DCDCAA;">NewSWRRServiceProvider</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;grpcdemo-server_rest&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewEnumDemo</span><span style="color:#D4D4D4;">(conf, client.</span><span style="color:#DCDCAA;">NewHelloworldClient</span><span style="color:#D4D4D4;">(restclient.</span><span style="color:#DCDCAA;">WithProvider</span><span style="color:#D4D4D4;">(restProvider)))</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewEnumDemoHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="\u7B80\u5355\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861-nacos\u7528" tabindex="-1"><a class="header-anchor" href="#\u7B80\u5355\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861-nacos\u7528" aria-hidden="true">#</a> \u7B80\u5355\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861 (nacos\u7528)</h3><p>\u9700\u8C03\u7528 <code>nacos.NewRRServiceProvider(&quot;\u6CE8\u518C\u5728nacos\u4E2D\u7684\u670D\u52A1\u540D\u79F0&quot;)</code> \u521B\u5EFA <code>nacos.RRServiceProvider</code> \u5B9E\u4F8B\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> nacos.</span><span style="color:#DCDCAA;">CloseNamingClient</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">conf</span><span style="color:#D4D4D4;"> := config.</span><span style="color:#DCDCAA;">LoadFromEnv</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">restProvider</span><span style="color:#D4D4D4;"> := nacos.</span><span style="color:#DCDCAA;">NewRRServiceProvider</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;grpcdemo-server_rest&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewEnumDemo</span><span style="color:#D4D4D4;">(conf, client.</span><span style="color:#DCDCAA;">NewHelloworldClient</span><span style="color:#D4D4D4;">(restclient.</span><span style="color:#DCDCAA;">WithProvider</span><span style="color:#D4D4D4;">(restProvider)))</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewEnumDemoHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="\u52A0\u6743\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861-nacos\u7528" tabindex="-1"><a class="header-anchor" href="#\u52A0\u6743\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861-nacos\u7528" aria-hidden="true">#</a> \u52A0\u6743\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861 (nacos\u7528)</h3><p>\u9700\u8C03\u7528 <code>nacos.NewWRRServiceProvider(&quot;\u6CE8\u518C\u5728nacos\u4E2D\u7684\u670D\u52A1\u540D\u79F0&quot;)</code> \u521B\u5EFA <code>nacos.WRRServiceProvider</code> \u5B9E\u4F8B\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> nacos.</span><span style="color:#DCDCAA;">CloseNamingClient</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">conf</span><span style="color:#D4D4D4;"> := config.</span><span style="color:#DCDCAA;">LoadFromEnv</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">restProvider</span><span style="color:#D4D4D4;"> := nacos.</span><span style="color:#DCDCAA;">NewWRRServiceProvider</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;grpcdemo-server_rest&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewEnumDemo</span><span style="color:#D4D4D4;">(conf, client.</span><span style="color:#DCDCAA;">NewHelloworldClient</span><span style="color:#D4D4D4;">(restclient.</span><span style="color:#DCDCAA;">WithProvider</span><span style="color:#D4D4D4;">(restProvider)))</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewEnumDemoHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="\u7B80\u5355\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861-zookeeper\u7528" tabindex="-1"><a class="header-anchor" href="#\u7B80\u5355\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861-zookeeper\u7528" aria-hidden="true">#</a> \u7B80\u5355\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861 (zookeeper\u7528)</h3><p>\u9700\u8C03\u7528 <code>zk.NewRRServiceProvider(&quot;\u6CE8\u518C\u5728zookeeper\u4E2D\u7684\u670D\u52A1\u540D\u79F0&quot;)</code> \u521B\u5EFA <code>zk.RRServiceProvider</code> \u5B9E\u4F8B\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">provider</span><span style="color:#D4D4D4;"> := zk.</span><span style="color:#DCDCAA;">NewRRServiceProvider</span><span style="color:#D4D4D4;">(zk.ServiceConfig{</span></span>
<span class="line"><span style="color:#D4D4D4;">		Name:    </span><span style="color:#CE9178;">&quot;cloud.unionj.ServiceB_rest&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">		Group:   </span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">		Version: </span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> provider.</span><span style="color:#DCDCAA;">Close</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">bClient</span><span style="color:#D4D4D4;"> := client.</span><span style="color:#DCDCAA;">NewServiceBClient</span><span style="color:#D4D4D4;">(restclient.</span><span style="color:#DCDCAA;">WithProvider</span><span style="color:#D4D4D4;">(provider))</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="\u52A0\u6743\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861-zookeeper\u7528" tabindex="-1"><a class="header-anchor" href="#\u52A0\u6743\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861-zookeeper\u7528" aria-hidden="true">#</a> \u52A0\u6743\u8F6E\u8BE2\u8D1F\u8F7D\u5747\u8861 (zookeeper\u7528)</h3><p>\u9700\u8C03\u7528 <code>zk.NewSWRRServiceProvider(&quot;\u6CE8\u518C\u5728zookeeper\u4E2D\u7684\u670D\u52A1\u540D\u79F0&quot;)</code> \u521B\u5EFA <code>zk.NewSWRRServiceProvider</code> \u5B9E\u4F8B\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">provider</span><span style="color:#D4D4D4;"> := zk.</span><span style="color:#DCDCAA;">NewSWRRServiceProvider</span><span style="color:#D4D4D4;">(zk.ServiceConfig{</span></span>
<span class="line"><span style="color:#D4D4D4;">		Name:    </span><span style="color:#CE9178;">&quot;cloud.unionj.ServiceB_rest&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">		Group:   </span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">		Version: </span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> provider.</span><span style="color:#DCDCAA;">Close</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">bClient</span><span style="color:#D4D4D4;"> := client.</span><span style="color:#DCDCAA;">NewServiceBClient</span><span style="color:#D4D4D4;">(restclient.</span><span style="color:#DCDCAA;">WithProvider</span><span style="color:#D4D4D4;">(provider))</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="\u9650\u6D41" tabindex="-1"><a class="header-anchor" href="#\u9650\u6D41" aria-hidden="true">#</a> \u9650\u6D41</h2><h3 id="\u7528\u6CD5" tabindex="-1"><a class="header-anchor" href="#\u7528\u6CD5" aria-hidden="true">#</a> \u7528\u6CD5</h3>`,42),B=s("code",null,"go-doudou",-1),I=n("\u5185\u7F6E\u4E86\u57FA\u4E8E"),V={href:"https://pkg.go.dev/golang.org/x/time/rate",target:"_blank",rel:"noopener noreferrer"},M=n("golang.org/x/time/rate"),T=n("\u5B9E\u73B0\u7684\u4EE4\u724C\u6876\u7B97\u6CD5\u7684\u5185\u5B58\u9650\u6D41\u5668\u3002"),O=e("<p>\u5728<code>github.com/unionj-cloud/go-doudou/v2/framework/ratelimit/memrate</code>\u5305\u91CC\u6709\u4E00\u4E2A<code>MemoryStore</code>\u7ED3\u6784\u4F53\uFF0C\u5B58\u50A8\u4E86key\u548C<code>Limiter</code>\u5B9E\u4F8B\u5BF9\u3002<code>Limiter</code>\u5B9E\u4F8B\u662F\u9650\u6D41\u5668\u5B9E\u4F8B\uFF0Ckey\u662F\u8BE5\u9650\u6D41\u5668\u5B9E\u4F8B\u7684\u952E\u3002</p><p>\u4F60\u53EF\u4EE5\u5F80<code>memrate.NewLimiter</code>\u5DE5\u5382\u51FD\u6570\u4F20\u5165\u4E00\u4E2A\u53EF\u9009\u51FD\u6570<code>memrate.WithTimer</code>\uFF0C\u8BBE\u7F6E\u5F53key\u7A7A\u95F2\u65F6\u95F4\u8D85\u8FC7<code>timeout</code>\u4EE5\u540E\u7684\u56DE\u8C03\u51FD\u6570\uFF0C\u6BD4\u5982\u53EF\u4EE5\u4ECE<code>MemoryStore</code>\u5B9E\u4F8B\u91CC\u5C06\u8BE5key\u5220\u9664\uFF0C\u4EE5\u91CA\u653E\u5185\u5B58\u8D44\u6E90\u3002</p>",2),L=s("code",null,"go-doudou",-1),z=n("\u8FD8\u63D0\u4F9B\u4E86\u57FA\u4E8E "),W={href:"https://github.com/go-redis/redis_rate",target:"_blank",rel:"noopener noreferrer"},H=n("go-redis/redis_rate"),j=n(" \u5E93\u5C01\u88C5\u7684GCRA\u9650\u6D41\u7B97\u6CD5\u7684redis\u9650\u6D41\u5668\u3002\u8BE5\u9650\u6D41\u5668\u652F\u6301\u8DE8\u5B9E\u4F8B\u7684\u5168\u5C40\u9650\u6D41\u3002"),Y=e(`<h3 id="\u5185\u5B58\u9650\u6D41\u5668\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#\u5185\u5B58\u9650\u6D41\u5668\u793A\u4F8B" aria-hidden="true">#</a> \u5185\u5B58\u9650\u6D41\u5668\u793A\u4F8B</h3><p>\u5185\u5B58\u9650\u6D41\u5668\u57FA\u4E8E\u672C\u673A\u5185\u5B58\uFF0C\u53EA\u652F\u6301\u672C\u673A\u9650\u6D41\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">store</span><span style="color:#D4D4D4;"> := memrate.</span><span style="color:#DCDCAA;">NewMemoryStore</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(_ context.Context, store *memrate.MemoryStore, key </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">) ratelimit.Limiter {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> memrate.</span><span style="color:#DCDCAA;">NewLimiter</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">30</span><span style="color:#D4D4D4;">, memrate.</span><span style="color:#DCDCAA;">WithTimer</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">*time.Second, </span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">			store.</span><span style="color:#DCDCAA;">DeleteKey</span><span style="color:#D4D4D4;">(key)</span></span>
<span class="line"><span style="color:#D4D4D4;">		}))</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddMiddleware</span><span style="color:#D4D4D4;">(</span></span>
<span class="line"><span style="color:#D4D4D4;">		httpsrv.</span><span style="color:#DCDCAA;">RateLimit</span><span style="color:#D4D4D4;">(store),</span></span>
<span class="line"><span style="color:#D4D4D4;">	)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewUsersvcHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>\u6CE8\u610F\uFF1A</strong> \u4F60\u9700\u8981\u81EA\u5DF1\u5B9E\u73B0http middleware\u3002\u4E0B\u9762\u662F\u4E00\u4E2A\u4F8B\u5B50\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">// RateLimit limits rate based on memrate.MemoryStore</span></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">RateLimit</span><span style="color:#D4D4D4;">(store *memrate.MemoryStore) </span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(inner http.Handler) http.Handler {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(inner http.Handler) http.Handler {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> http.</span><span style="color:#DCDCAA;">HandlerFunc</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(w http.ResponseWriter, r *http.Request) {</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;"> := r.RemoteAddr[:strings.</span><span style="color:#DCDCAA;">LastIndex</span><span style="color:#D4D4D4;">(r.RemoteAddr, </span><span style="color:#CE9178;">&quot;:&quot;</span><span style="color:#D4D4D4;">)]</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#9CDCFE;">limiter</span><span style="color:#D4D4D4;"> := store.</span><span style="color:#DCDCAA;">GetLimiter</span><span style="color:#D4D4D4;">(key)</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> !limiter.</span><span style="color:#DCDCAA;">Allow</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">				http.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(w, </span><span style="color:#CE9178;">&quot;too many requests&quot;</span><span style="color:#D4D4D4;">, http.StatusTooManyRequests)</span></span>
<span class="line"><span style="color:#D4D4D4;">				</span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">			}</span></span>
<span class="line"><span style="color:#D4D4D4;">			inner.</span><span style="color:#DCDCAA;">ServeHTTP</span><span style="color:#D4D4D4;">(w, r)</span></span>
<span class="line"><span style="color:#D4D4D4;">		})</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="redis\u9650\u6D41\u5668\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#redis\u9650\u6D41\u5668\u793A\u4F8B" aria-hidden="true">#</a> Redis\u9650\u6D41\u5668\u793A\u4F8B</h3><p>Redis\u9650\u6D41\u5668\u53EF\u4EE5\u7528\u4E8E\u9700\u8981\u591A\u4E2A\u5B9E\u4F8B\u540C\u65F6\u5BF9\u4E00\u4E2Akey\u9650\u6D41\u7684\u573A\u666F\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewWordcloudBff</span><span style="color:#D4D4D4;">(conf, minioClient, makerClientProxy, taskClientProxy, userClientProxy)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewWordcloudBffHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddMiddleware</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Auth</span><span style="color:#D4D4D4;">(userClientProxy))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">rdb</span><span style="color:#D4D4D4;"> := redis.</span><span style="color:#DCDCAA;">NewClient</span><span style="color:#D4D4D4;">(&amp;redis.Options{</span></span>
<span class="line"><span style="color:#D4D4D4;">		Addr: fmt.</span><span style="color:#DCDCAA;">Sprintf</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;</span><span style="color:#9CDCFE;">%s</span><span style="color:#CE9178;">:6379&quot;</span><span style="color:#D4D4D4;">, conf.RedisConf.Host),</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">fn</span><span style="color:#D4D4D4;"> := redisrate.</span><span style="color:#DCDCAA;">LimitFn</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(ctx context.Context) ratelimit.Limit {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> ratelimit.</span><span style="color:#DCDCAA;">PerSecondBurst</span><span style="color:#D4D4D4;">(conf.ConConf.RatelimitRate, conf.ConConf.RatelimitBurst)</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddMiddleware</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">RedisRateLimit</span><span style="color:#D4D4D4;">(rdb, fn))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong>\u6CE8\u610F\uFF1A</strong> \u4F60\u9700\u8981\u81EA\u5DF1\u5B9E\u73B0http middleware\u3002\u4E0B\u9762\u662F\u4E00\u4E2A\u4F8B\u5B50\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">// RedisRateLimit limits rate based on redisrate.GcraLimiter</span></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">RedisRateLimit</span><span style="color:#D4D4D4;">(rdb redisrate.Rediser, fn redisrate.LimitFn) </span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(inner http.Handler) http.Handler {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(inner http.Handler) http.Handler {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> http.</span><span style="color:#DCDCAA;">HandlerFunc</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(w http.ResponseWriter, r *http.Request) {</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#9CDCFE;">userId</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">_</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">UserIdFromContext</span><span style="color:#D4D4D4;">(r.</span><span style="color:#DCDCAA;">Context</span><span style="color:#D4D4D4;">())</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#9CDCFE;">limiter</span><span style="color:#D4D4D4;"> := redisrate.</span><span style="color:#DCDCAA;">NewGcraLimiterLimitFn</span><span style="color:#D4D4D4;">(rdb, strconv.</span><span style="color:#DCDCAA;">Itoa</span><span style="color:#D4D4D4;">(userId), fn)</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> !limiter.</span><span style="color:#DCDCAA;">Allow</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">				http.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(w, </span><span style="color:#CE9178;">&quot;too many requests&quot;</span><span style="color:#D4D4D4;">, http.StatusTooManyRequests)</span></span>
<span class="line"><span style="color:#D4D4D4;">				</span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">			}</span></span>
<span class="line"><span style="color:#D4D4D4;">			inner.</span><span style="color:#DCDCAA;">ServeHTTP</span><span style="color:#D4D4D4;">(w, r)</span></span>
<span class="line"><span style="color:#D4D4D4;">		})</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="\u9694\u4ED3" tabindex="-1"><a class="header-anchor" href="#\u9694\u4ED3" aria-hidden="true">#</a> \u9694\u4ED3</h2><h3 id="\u7528\u6CD5-1" tabindex="-1"><a class="header-anchor" href="#\u7528\u6CD5-1" aria-hidden="true">#</a> \u7528\u6CD5</h3>`,12),U=s("code",null,"go-doudou",-1),J=n("\u5728"),K=s("code",null,"github.com/unionj-cloud/go-doudou/v2/framework/rest",-1),Z=n("\u5305\u4E2D\u5185\u7F6E\u4E86\u57FA\u4E8E "),Q={href:"https://github.com/slok/goresilience",target:"_blank",rel:"noopener noreferrer"},X=n("github.com/slok/goresilience"),$=n(" \u5C01\u88C5\u7684\u5F00\u7BB1\u5373\u7528\u7684\u9694\u4ED3\u529F\u80FD\u3002"),ss=e(`<div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">rest.</span><span style="color:#DCDCAA;">BulkHead</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">*time.Millisecond)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4E0A\u9762\u7684\u793A\u4F8B\u4EE3\u7801\u4E2D\uFF0C\u7B2C\u4E00\u4E2A\u53C2\u6570<code>3</code>\u8868\u793A\u7528\u4E8E\u5904\u7406http\u8BF7\u6C42\u7684goroutine\u6C60\u4E2D\u7684worker\u6570\u91CF\uFF0C\u7B2C\u4E8C\u4E2A\u53C2\u6570<code>10*time.Millisecond</code>\u8868\u793A\u4E00\u4E2Ahttp\u8BF7\u6C42\u8FDB\u6765\u4EE5\u540E\u7B49\u5F85\u88AB\u5904\u7406\u7684\u6700\u957F\u7B49\u5F85\u65F6\u95F4\uFF0C\u5982\u679C\u8D85\u65F6\uFF0C\u5373\u76F4\u63A5\u8FD4\u56DE<code>429</code>\u72B6\u6001\u7801\u3002</p><h3 id="\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B" aria-hidden="true">#</a> \u793A\u4F8B</h3><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewWordcloudBff</span><span style="color:#D4D4D4;">(conf, minioClient, makerClientProxy, taskClientProxy, userClientProxy)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewWordcloudBffHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddMiddleware</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Auth</span><span style="color:#D4D4D4;">(userClientProxy))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">rdb</span><span style="color:#D4D4D4;"> := redis.</span><span style="color:#DCDCAA;">NewClient</span><span style="color:#D4D4D4;">(&amp;redis.Options{</span></span>
<span class="line"><span style="color:#D4D4D4;">		Addr: fmt.</span><span style="color:#DCDCAA;">Sprintf</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;</span><span style="color:#9CDCFE;">%s</span><span style="color:#CE9178;">:6379&quot;</span><span style="color:#D4D4D4;">, conf.RedisConf.Host),</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">fn</span><span style="color:#D4D4D4;"> := redisrate.</span><span style="color:#DCDCAA;">LimitFn</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(ctx context.Context) ratelimit.Limit {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> ratelimit.</span><span style="color:#DCDCAA;">PerSecondBurst</span><span style="color:#D4D4D4;">(conf.ConConf.RatelimitRate, conf.ConConf.RatelimitBurst)</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddMiddleware</span><span style="color:#D4D4D4;">(rest.</span><span style="color:#DCDCAA;">BulkHead</span><span style="color:#D4D4D4;">(conf.ConConf.BulkheadWorkers, conf.ConConf.BulkheadMaxwaittime))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="\u7194\u65AD-\u8D85\u65F6-\u91CD\u8BD5" tabindex="-1"><a class="header-anchor" href="#\u7194\u65AD-\u8D85\u65F6-\u91CD\u8BD5" aria-hidden="true">#</a> \u7194\u65AD / \u8D85\u65F6 / \u91CD\u8BD5</h2><h3 id="\u7528\u6CD5-2" tabindex="-1"><a class="header-anchor" href="#\u7528\u6CD5-2" aria-hidden="true">#</a> \u7528\u6CD5</h3>`,6),ns=s("code",null,"go-doudou",-1),as=n("\u5728\u751F\u6210\u7684\u5BA2\u6237\u7AEF\u4EE3\u7801\u91CC\u5185\u7F6E\u4E86\u57FA\u4E8E "),ls={href:"https://github.com/slok/goresilience",target:"_blank",rel:"noopener noreferrer"},es=n("github.com/slok/goresilience"),ps=n(" \u5C01\u88C5\u7684\u7194\u65AD/\u8D85\u65F6/\u91CD\u8BD5\u7B49\u5F39\u6027\u673A\u5236\u7684\u4EE3\u7801\u3002\u4F60\u53EA\u9700\u8981\u6267\u884C\u5982\u4E0B\u547D\u4EE4\uFF0C\u751F\u6210\u5BA2\u6237\u7AEF\u4EE3\u7801\u62FF\u6765\u7528\u5373\u53EF"),os=e(`<div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">go-doudou svc http -c</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><code>-c</code>\u53C2\u6570\u8868\u793A\u751F\u6210Go\u8BED\u8A00\u5BA2\u6237\u7AEF\u4EE3\u7801\u3002\u751F\u6210\u7684<code>client</code>\u5305\u7684\u76EE\u5F55\u7ED3\u6784\u5982\u4E0B</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">\u251C\u2500\u2500 client.go</span></span>
<span class="line"><span style="color:#D4D4D4;">\u251C\u2500\u2500 clientproxy.go</span></span>
<span class="line"><span style="color:#D4D4D4;">\u2514\u2500\u2500 iclient.go</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u751F\u6210\u7684\u4EE3\u7801\u91CC\u5DF2\u7ECF\u6709\u9ED8\u8BA4\u7684<code>goresilience.Runner</code>\u5B9E\u4F8B\uFF0C\u4F60\u4E5F\u53EF\u4EE5\u901A\u8FC7<code>WithRunner(your_own_runner goresilience.Runner)</code>\u51FD\u6570\u4F20\u5165\u81EA\u5B9A\u4E49\u7684\u5B9E\u73B0\u3002</p><h3 id="\u793A\u4F8B-1" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B-1" aria-hidden="true">#</a> \u793A\u4F8B</h3><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">conf</span><span style="color:#D4D4D4;"> := config.</span><span style="color:#DCDCAA;">LoadFromEnv</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#569CD6;">var</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">segClient</span><span style="color:#D4D4D4;"> *segclient.WordcloudSegClient</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> os.</span><span style="color:#DCDCAA;">Getenv</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;GDD_SERVICE_DISCOVERY_MODE&quot;</span><span style="color:#D4D4D4;">) != </span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">provider</span><span style="color:#D4D4D4;"> := etcd.</span><span style="color:#DCDCAA;">NewSWRRServiceProvider</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;wordcloud-segsvc_rest&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">segClient</span><span style="color:#D4D4D4;"> = segclient.</span><span style="color:#DCDCAA;">NewWordcloudSegClient</span><span style="color:#D4D4D4;">(restclient.</span><span style="color:#DCDCAA;">WithProvider</span><span style="color:#D4D4D4;">(provider))</span></span>
<span class="line"><span style="color:#D4D4D4;">	} </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">segClient</span><span style="color:#D4D4D4;"> = segclient.</span><span style="color:#DCDCAA;">NewWordcloudSegClient</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">segClientProxy</span><span style="color:#D4D4D4;"> := segclient.</span><span style="color:#DCDCAA;">NewWordcloudSegClientProxy</span><span style="color:#D4D4D4;">(segClient)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	... </span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewWordcloudMaker</span><span style="color:#D4D4D4;">(conf, segClientProxy, minioClient, browser)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="\u65E5\u5FD7" tabindex="-1"><a class="header-anchor" href="#\u65E5\u5FD7" aria-hidden="true">#</a> \u65E5\u5FD7</h2><h3 id="\u7528\u6CD5-3" tabindex="-1"><a class="header-anchor" href="#\u7528\u6CD5-3" aria-hidden="true">#</a> \u7528\u6CD5</h3><p><code>go-doudou</code>\u5728<code>github.com/unionj-cloud/go-doudou/v2/toolkit/zlogger</code>\u5305\u91CC\u5185\u7F6E\u4E86\u4E00\u4E2A\u5168\u5C40\u7684<code>zerolog.Logger</code>\u3002\u5982\u679C<code>GDD_ENV</code>\u73AF\u5883\u53D8\u91CF\u4E0D\u7B49\u4E8E\u7A7A\u5B57\u7B26\u4E32\u548C<code>dev</code>\uFF0C\u5219\u4F1A\u5E26\u4E0A\u4E00\u4E9B\u5173\u4E8E\u670D\u52A1\u672C\u8EAB\u7684\u5143\u6570\u636E\u3002</p><p>\u4F60\u4E5F\u53EF\u4EE5\u8C03\u7528<code>InitEntry</code>\u51FD\u6570\u81EA\u5B9A\u4E49<code>zerolog.Logger</code>\u5B9E\u4F8B\u3002</p><p>\u4F60\u8FD8\u53EF\u4EE5\u901A\u8FC7\u914D\u7F6E<code>GDD_LOG_LEVEL</code>\u73AF\u5883\u53D8\u91CF\u6765\u8BBE\u7F6E\u65E5\u5FD7\u7EA7\u522B\uFF0C\u914D\u7F6E<code>GDD_LOG_FORMAT</code>\u73AF\u5883\u53D8\u91CF\u6765\u8BBE\u7F6E\u65E5\u5FD7\u683C\u5F0F\u662F<code>json</code>\u8FD8\u662F<code>text</code>\u3002</p><p>\u4F60\u53EF\u4EE5\u901A\u8FC7\u914D\u7F6E<code>GDD_LOG_REQ_ENABLE=true</code>\u6765\u5F00\u542Fhttp\u8BF7\u6C42\u548C\u54CD\u5E94\u7684\u65E5\u5FD7\u6253\u5370\uFF0C\u9ED8\u8BA4\u662F<code>false</code>\uFF0C\u5373\u4E0D\u6253\u5370\u3002</p><h3 id="\u793A\u4F8B-2" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B-2" aria-hidden="true">#</a> \u793A\u4F8B</h3><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">// \u4F60\u53EF\u4EE5\u7528lumberjack\u8FD9\u4E2A\u5E93\u7ED9\u670D\u52A1\u589E\u52A0\u65E5\u5FD7rotate\u7684\u529F\u80FD</span></span>
<span class="line"><span style="color:#D4D4D4;">zlogger.</span><span style="color:#DCDCAA;">SetOutput</span><span style="color:#D4D4D4;">(io.</span><span style="color:#DCDCAA;">MultiWriter</span><span style="color:#D4D4D4;">(os.Stdout, &amp;lumberjack.Logger{</span></span>
<span class="line"><span style="color:#D4D4D4;">			Filename:   filepath.</span><span style="color:#DCDCAA;">Join</span><span style="color:#D4D4D4;">(os.</span><span style="color:#DCDCAA;">Getenv</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;LOG_PATH&quot;</span><span style="color:#D4D4D4;">), fmt.</span><span style="color:#DCDCAA;">Sprintf</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;</span><span style="color:#9CDCFE;">%s</span><span style="color:#CE9178;">.log&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;usersvc&quot;</span><span style="color:#D4D4D4;">)),</span></span>
<span class="line"><span style="color:#D4D4D4;">		  MaxSize:    </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">,  </span><span style="color:#6A9955;">// \u5355\u4EFD\u65E5\u5FD7\u6587\u4EF6\u6700\u59275M\uFF0C\u8D85\u8FC7\u5C31\u4F1A\u521B\u5EFA\u65B0\u7684\u65E5\u5FD7\u6587\u4EF6</span></span>
<span class="line"><span style="color:#D4D4D4;">      MaxBackups: </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// \u6700\u591A\u4FDD\u755910\u4EFD\u65E5\u5FD7\u6587\u4EF6</span></span>
<span class="line"><span style="color:#D4D4D4;">      MaxAge:     </span><span style="color:#B5CEA8;">7</span><span style="color:#D4D4D4;">,  </span><span style="color:#6A9955;">// \u65E5\u5FD7\u6587\u4EF6\u6700\u957F\u4FDD\u75597\u5929</span></span>
<span class="line"><span style="color:#D4D4D4;">      Compress:   </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// \u662F\u5426\u5F00\u542F\u65E5\u5FD7\u538B\u7F29</span></span>
<span class="line"><span style="color:#D4D4D4;">}))</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="elk\u6280\u672F\u6808" tabindex="-1"><a class="header-anchor" href="#elk\u6280\u672F\u6808" aria-hidden="true">#</a> ELK\u6280\u672F\u6808</h3><p><code>logger</code>\u5305\u652F\u6301\u96C6\u6210ELK\u6280\u672F\u6808\u3002</p><h4 id="\u793A\u4F8B-3" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B-3" aria-hidden="true">#</a> \u793A\u4F8B</h4><div class="language-yaml ext-yml line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">version</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&#39;3.9&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">services</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">elasticsearch</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">container_name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">elasticsearch</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">image</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;docker.elastic.co/elasticsearch/elasticsearch:7.2.0&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">environment</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">     - </span><span style="color:#CE9178;">&quot;ES_JAVA_OPTS=-Xms1g -Xmx1g&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">     - </span><span style="color:#CE9178;">&quot;discovery.type=single-node&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">ports</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">     - </span><span style="color:#CE9178;">&quot;9200:9200&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">volumes</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">     - </span><span style="color:#CE9178;">./esdata:/usr/share/elasticsearch/data</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">networks</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">     </span><span style="color:#569CD6;">testing_net</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">       </span><span style="color:#569CD6;">ipv4_address</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">172.28.1.9</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">kibana</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">container_name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">kibana</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">image</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;docker.elastic.co/kibana/kibana:7.2.0&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">ports</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">     - </span><span style="color:#CE9178;">&quot;5601:5601&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">networks</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">     </span><span style="color:#569CD6;">testing_net</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">       </span><span style="color:#569CD6;">ipv4_address</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">172.28.1.10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">filebeat</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">container_name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">filebeat</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">image</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;docker.elastic.co/beats/filebeat:7.2.0&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">volumes</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">     - </span><span style="color:#CE9178;">./filebeat.yml:/usr/share/filebeat/filebeat.yml:ro</span></span>
<span class="line"><span style="color:#D4D4D4;">     - </span><span style="color:#CE9178;">./log:/var/log</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">networks</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">     </span><span style="color:#569CD6;">testing_net</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">       </span><span style="color:#569CD6;">ipv4_address</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">172.28.1.11</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">networks</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">testing_net</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">ipam</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">driver</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">default</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">config</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        - </span><span style="color:#569CD6;">subnet</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">172.28.0.0/16</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h4 id="\u622A\u56FE" tabindex="-1"><a class="header-anchor" href="#\u622A\u56FE" aria-hidden="true">#</a> \u622A\u56FE</h4><p><img src="`+i+`" alt="elk"></p><h2 id="jaeger\u8C03\u7528\u94FE\u76D1\u63A7" tabindex="-1"><a class="header-anchor" href="#jaeger\u8C03\u7528\u94FE\u76D1\u63A7" aria-hidden="true">#</a> Jaeger\u8C03\u7528\u94FE\u76D1\u63A7</h2><h3 id="\u7528\u6CD5-4" tabindex="-1"><a class="header-anchor" href="#\u7528\u6CD5-4" aria-hidden="true">#</a> \u7528\u6CD5</h3><p>\u96C6\u6210Jaeger\u8C03\u7528\u94FE\u76D1\u63A7\u9700\u8981\u4EE5\u4E0B\u6B65\u9AA4</p><ol><li>\u542F\u52A8Jaeger</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">docker run -d --name jaeger \\</span></span>
<span class="line"><span style="color:#D4D4D4;">  -p 6831:6831/udp \\</span></span>
<span class="line"><span style="color:#D4D4D4;">  -p 16686:16686 \\</span></span>
<span class="line"><span style="color:#D4D4D4;">  jaegertracing/all-in-one:1.29</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>\u7ED9<code>.env</code>\u6587\u4EF6\u6DFB\u52A0\u4E24\u884C\u914D\u7F6E</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">JAEGER_AGENT_HOST=localhost</span></span>
<span class="line"><span style="color:#D4D4D4;">JAEGER_AGENT_PORT=6831</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li>\u5728<code>main</code>\u51FD\u6570\u91CC\u9760\u524D\u7684\u4F4D\u7F6E\u6DFB\u52A0\u4E09\u884C\u4EE3\u7801</li></ol><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#9CDCFE;">tracer</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">closer</span><span style="color:#D4D4D4;"> := tracing.</span><span style="color:#DCDCAA;">Init</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> closer.</span><span style="color:#DCDCAA;">Close</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">opentracing.</span><span style="color:#DCDCAA;">SetGlobalTracer</span><span style="color:#D4D4D4;">(tracer)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u7136\u540E\u4F60\u7684<code>main</code>\u51FD\u6570\u5E94\u8BE5\u662F\u7C7B\u4F3C\u8FD9\u4E2A\u6837\u5B50</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">tracer</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">closer</span><span style="color:#D4D4D4;"> := tracing.</span><span style="color:#DCDCAA;">Init</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> closer.</span><span style="color:#DCDCAA;">Close</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	opentracing.</span><span style="color:#DCDCAA;">SetGlobalTracer</span><span style="color:#D4D4D4;">(tracer)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewWordcloudMaker</span><span style="color:#D4D4D4;">(conf, segClientProxy, minioClient, browser)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewWordcloudMakerHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="\u622A\u56FE-1" tabindex="-1"><a class="header-anchor" href="#\u622A\u56FE-1" aria-hidden="true">#</a> \u622A\u56FE</h3><p><img src="`+y+'" alt="jaeger1"><img src="'+d+`" alt="jaeger2"></p><h2 id="\u9650\u5236\u8BF7\u6C42\u4F53\u5927\u5C0F" tabindex="-1"><a class="header-anchor" href="#\u9650\u5236\u8BF7\u6C42\u4F53\u5927\u5C0F" aria-hidden="true">#</a> \u9650\u5236\u8BF7\u6C42\u4F53\u5927\u5C0F</h2><p>\u4E3A\u4E86\u670D\u52A1\u7684\u7A33\u5B9A\u548C\u5B89\u5168\uFF0C\u9650\u5236\u8BF7\u6C42\u4F53\u7684\u5927\u5C0F\u662F\u5FC5\u8981\u7684\uFF0C\u6211\u4EEC\u53EF\u4EE5\u7528<code>rest</code>\u5305\u91CC\u7684<code>BodyMaxBytes</code>\u4E2D\u95F4\u4EF6\u5B9E\u73B0\u8FD9\u4E2A\u9700\u6C42\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">package</span><span style="color:#D4D4D4;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">import</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewOrdersvcHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#6A9955;">// \u9650\u5236\u8BF7\u6C42\u4F53\u5927\u5C0F\u4E0D\u8D85\u8FC732M</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Use</span><span style="color:#D4D4D4;">(rest.</span><span style="color:#DCDCAA;">BodyMaxBytes</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">32</span><span style="color:#D4D4D4;"> &lt;&lt; </span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">))</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="\u7F51\u5173" tabindex="-1"><a class="header-anchor" href="#\u7F51\u5173" aria-hidden="true">#</a> \u7F51\u5173</h2><p>\u5728\u9879\u76EE\u5B9E\u8DF5\u4E2D\uFF0C\u4E00\u4E2A\u524D\u7AEF\u5DE5\u7A0B\u53EF\u80FD\u9700\u8981\u8C03\u7528\u591A\u4E2A\u670D\u52A1\u63A5\u53E3\uFF0C\u524D\u7AEF\u540C\u4E8B\u505A\u914D\u7F6E\u4F1A\u5F88\u4E0D\u65B9\u4FBF\uFF0C\u8FD9\u65F6\u7F51\u5173\u670D\u52A1\u5C31\u6D3E\u4E0A\u7528\u573A\u4E86\u3002\u524D\u7AEF\u540C\u4E8B\u53EA\u9700\u8981\u5728\u914D\u7F6E\u6587\u4EF6\u4E2D\u914D\u7F6E\u4E00\u4E2A\u7F51\u5173\u670D\u52A1\u5730\u5740\u5373\u53EF\uFF0C\u7136\u540E\u901A\u8FC7<code>/\u670D\u52A1\u540D\u79F0/\u63A5\u53E3\u8DEF\u5F84</code>\u7684\u65B9\u5F0F\u5C31\u53EF\u4EE5\u8BF7\u6C42\u5230\u591A\u4E2A\u4E0D\u540C\u7684\u5FAE\u670D\u52A1\u3002\u6211\u4EEC\u53EF\u4EE5\u7528<code>rest</code>\u5305\u7684<code>Proxy</code>\u4E2D\u95F4\u4EF6\u5B9E\u73B0\u8FD9\u4E2A\u9700\u6C42\u3002</p><p>\u7F51\u5173\u670D\u52A1\u5FC5\u987B\u81EA\u5DF1\u4E5F\u6CE8\u518C\u5230nacos\u670D\u52A1\u6CE8\u518C\u4E2D\u5FC3\u6216\u8005etcd\u96C6\u7FA4\uFF0C\u6216\u8005\u540C\u65F6\u52A0\u5165\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">package</span><span style="color:#D4D4D4;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">import</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;github.com/unionj-cloud/go-doudou/v2/framework/rest&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddMiddleware</span><span style="color:#D4D4D4;">(rest.</span><span style="color:#DCDCAA;">Proxy</span><span style="color:#D4D4D4;">(rest.ProxyConfig{}))</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>.env</code>\u914D\u7F6E\u6587\u4EF6\u793A\u4F8B</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_NAME=gateway</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_DISCOVERY_MODE=nacos,etcd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># nacos\u76F8\u5173\u914D\u7F6E</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_NACOS_SERVER_ADDR=http://localhost:8848/nacos</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_NACOS_NOT_LOAD_CACHE_AT_START=true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># etcd\u76F8\u5173\u914D\u7F6E</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_ETCD_ENDPOINTS=localhost:2379</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><em>\u6CE8\u610F\uFF1A</em> \u6CE8\u518C\u5728nacos\u6CE8\u518C\u4E2D\u5FC3\u7684\u975Ego-doudou\u6846\u67B6\u5F00\u53D1\u7684\u5E94\u7528\uFF0C\u5982\u679C\u6709\u8DEF\u7531\u524D\u7F00\uFF0C\u5219\u5FC5\u987B\u5C06\u5176\u8BBE\u7F6E\u5230<code>metadata</code>\u91CC\u7684<code>rootPath</code>\u5C5E\u6027\uFF0C\u5426\u5219\u7F51\u5173\u53EF\u80FD\u4F1A\u62A5404\u3002</p><h2 id="\u8BF7\u6C42\u4F53\u548C\u8BF7\u6C42\u53C2\u6570\u6821\u9A8C" tabindex="-1"><a class="header-anchor" href="#\u8BF7\u6C42\u4F53\u548C\u8BF7\u6C42\u53C2\u6570\u6821\u9A8C" aria-hidden="true">#</a> \u8BF7\u6C42\u4F53\u548C\u8BF7\u6C42\u53C2\u6570\u6821\u9A8C</h2>`,44),rs=n("go-doudou \u4ECEv1.1.9\u7248\u672C\u8D77\u65B0\u589E\u57FA\u4E8E "),cs={href:"https://github.com/go-playground/validator",target:"_blank",rel:"noopener noreferrer"},ts=n("go-playground/validator"),Ds=n(" \u7684\u9488\u5BF9\u8BF7\u6C42\u4F53\u548C\u8BF7\u6C42\u53C2\u6570\u7684\u6821\u9A8C\u673A\u5236\u3002"),is=s("h3",{id:"\u7528\u6CD5-5",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u7528\u6CD5-5","aria-hidden":"true"},"#"),n(" \u7528\u6CD5")],-1),ys=s("p",null,"go-doudou \u5185\u5EFA\u652F\u6301\u7684\u8BF7\u6C42\u6821\u9A8C\u673A\u5236\u5982\u4E0B\uFF1A",-1),ds=s("li",null,"\u63A5\u53E3\u5B9A\u4E49\u65F6\u4F20\u5165\u7684\u6307\u9488\u7C7B\u578B\u7684\u53C2\u6570\u90FD\u662F\u975E\u5FC5\u987B\u53C2\u6570\uFF0C\u975E\u6307\u9488\u7C7B\u578B\u7684\u53C2\u6570\u90FD\u662F\u5FC5\u987B\u53C2\u6570\uFF1B",-1),us=n("\u63A5\u53E3\u5B9A\u4E49\u65F6\u53EF\u5728\u65B9\u6CD5\u5165\u53C2\u7684\u4E0A\u65B9\u4EE5go\u8BED\u8A00\u6CE8\u91CA\u7684\u5F62\u5F0F\uFF0C\u52A0\u4E0A"),bs=s("code",null,"@validate",-1),Cs=n("\u6CE8\u89E3\uFF0C\u987B\u9075\u5FAA"),ms=n("\u63A5\u53E3\u5B9A\u4E49-\u6CE8\u89E3"),hs=n("\u7AE0\u8282\u8BF4\u660E\u7684\u6CE8\u89E3\u8BED\u6CD5\u548C\u683C\u5F0F\uFF0C\u4F20\u5165\u5177\u4F53\u7684\u6821\u9A8C\u89C4\u5219\u4F5C\u4E3A\u6CE8\u89E3\u7684\u53C2\u6570\uFF1B"),As=s("li",null,[n("vo\u5305\u91CC\u5B9A\u4E49struct\u7ED3\u6784\u4F53\u65F6\u53EF\u4EE5\u5728\u5C5E\u6027\u7684tag\u91CC\u52A0\u4E0A"),s("code",null,"validate"),n("\u6807\u7B7E\uFF0C\u5728\u540E\u9762\u5199\u4E0A\u5177\u4F53\u7684\u6821\u9A8C\u89C4\u5219\uFF1B")],-1),Es=s("p",null,[n("\u4EE5\u4E0A\u7B2C2\u70B9\u548C\u7B2C3\u70B9\u91CC\u63D0\u5230\u7684\u6821\u9A8C\u89C4\u5219\u4EC5\u652F\u6301 "),s("code",null,"go-playground/validator"),n(" \u5E93\u4E2D\u7684\u89C4\u5219\u3002go-doudou\u5B9E\u9645\u6821\u9A8C\u8BF7\u6C42\u4F53\u548C\u8BF7\u6C42\u53C2\u6570\u7684\u4EE3\u7801\u90FD\u5728go-doudou\u547D\u4EE4\u884C\u5DE5\u5177\u751F\u6210\u7684"),s("code",null,"handlerimpl.go"),n("\u6587\u4EF6\u4E2D\uFF0C\u53EA\u6709struct\u7C7B\u578B\uFF08\u5305\u62ECstruct\u6307\u9488\u7C7B\u578B\uFF09\u7684\u53C2\u6570\u5E95\u5C42\u901A\u8FC7 "),s("code",null,"func (v *Validate) Struct(s interface{}) error"),n(" \u65B9\u6CD5\u6821\u9A8C\uFF0C\u5176\u4ED6\u7C7B\u578B\u7684\u53C2\u6570\u5E95\u5C42\u90FD\u901A\u8FC7 "),s("code",null,"func (v *Validate) Var(field interface{}, tag string) error"),n(" \u65B9\u6CD5\u6821\u9A8C\u3002")],-1),gs=n("go-doudou \u7684"),vs=s("code",null,"ddhttp",-1),_s=n("\u5305\u901A\u8FC7\u5BFC\u51FA\u51FD\u6570 "),fs=s("code",null,"func GetValidate() *validator.Validate",-1),Rs=n(" \u5BF9\u5916\u63D0\u4F9B\u4E86"),ks=s("code",null,"*validator.Validate",-1),qs=n("\u7C7B\u578B\u7684\u5355\u4F8B\uFF0C\u5F00\u53D1\u8005\u53EF\u4EE5\u901A\u8FC7\u8FD9\u4E2A\u5355\u4F8B\u8C03\u7528\u7531"),xs=s("code",null,"go-playground/validator",-1),Ss=n("\u76F4\u63A5\u63D0\u4F9B\u7684api\u6765\u5B9E\u73B0\u66F4\u590D\u6742\u7684\u3001\u81EA\u5B9A\u4E49\u7684\u9700\u6C42\uFF0C\u6BD4\u5982\u9519\u8BEF\u4FE1\u606F\u4E2D\u6587\u7FFB\u8BD1\u3001\u81EA\u5B9A\u4E49\u6821\u9A8C\u89C4\u5219\u7B49\u7B49\uFF0C\u8BF7\u53C2\u8003"),Fs=s("code",null,"go-playground/validator",-1),Ns=n("\u7684"),ws={href:"https://pkg.go.dev/github.com/go-playground/validator/v10",target:"_blank",rel:"noopener noreferrer"},Gs=n("\u5B98\u65B9\u6587\u6863"),Ps=n("\u548C"),Bs={href:"https://github.com/go-playground/validator/tree/master/_examples",target:"_blank",rel:"noopener noreferrer"},Is=n("\u5B98\u65B9\u793A\u4F8B"),Vs=n("\u3002"),Ms=e(`<h3 id="\u793A\u4F8B-4" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B-4" aria-hidden="true">#</a> \u793A\u4F8B</h3><p>\u63A5\u53E3\u5B9A\u4E49\u793A\u4F8B</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">// &lt;b style=&quot;color: red&quot;&gt;NEW&lt;/b&gt; \u6587\u7AE0\u65B0\u5EFA\u548C\u66F4\u65B0\u63A5\u53E3</span></span>
<span class="line"><span style="color:#6A9955;">// \u4F20\u8FDB\u6765\u7684\u53C2\u6570\u91CC\u6709id\u6267\u884C\u66F4\u65B0\u64CD\u4F5C\uFF0C\u6CA1\u6709id\u6267\u884C\u521B\u5EFA\u64CD\u4F5C</span></span>
<span class="line"><span style="color:#6A9955;">// @role(SUPER_ADMIN)</span></span>
<span class="line"><span style="color:#DCDCAA;">Article</span><span style="color:#D4D4D4;">(ctx context.Context, file *v3.FileModel,</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#6A9955;">// @validate(gt=0,lte=60)</span></span>
<span class="line"><span style="color:#D4D4D4;">	title,</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#6A9955;">// @validate(gt=0,lte=1000)</span></span>
<span class="line"><span style="color:#D4D4D4;">	content *</span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">, tags *[]</span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">, sort, status *</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">, id *</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">) (data </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">, err </span><span style="color:#4EC9B0;">error</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>vo\u5305\u4E2D\u7684struct\u7ED3\u6784\u4F53\u793A\u4F8B</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">type</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">ArticleVo</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">struct</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">	Id      </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">\`json:&quot;id&quot;\`</span></span>
<span class="line"><span style="color:#D4D4D4;">	Title   </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">\`json:&quot;title&quot; validate:&quot;required,gt=0,lte=60&quot;\`</span></span>
<span class="line"><span style="color:#D4D4D4;">	Content </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">\`json:&quot;content&quot;\`</span></span>
<span class="line"><span style="color:#D4D4D4;">	Link    </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">\`json:&quot;link&quot; validate:&quot;required,url&quot;\`</span></span>
<span class="line"><span style="color:#D4D4D4;">	CreateAt </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">\`json:&quot;createAt&quot;\`</span></span>
<span class="line"><span style="color:#D4D4D4;">	UpdateAt </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">\`json:&quot;updateAt&quot;\`</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u751F\u6210\u7684\u4EE3\u7801\u793A\u4F8B</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> (receiver *ArticleHandlerImpl) </span><span style="color:#DCDCAA;">ArticleList</span><span style="color:#D4D4D4;">(_writer http.ResponseWriter, _req *http.Request) {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#569CD6;">var</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">ctx</span><span style="color:#D4D4D4;">     context.Context</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">payload</span><span style="color:#D4D4D4;"> vo.ArticlePageQuery</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">    vo.ArticleRet</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">err</span><span style="color:#D4D4D4;">     </span><span style="color:#4EC9B0;">error</span></span>
<span class="line"><span style="color:#D4D4D4;">	)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">ctx</span><span style="color:#D4D4D4;"> = _req.</span><span style="color:#DCDCAA;">Context</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> _req.Body == </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">		http.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(_writer, </span><span style="color:#CE9178;">&quot;missing request body&quot;</span><span style="color:#D4D4D4;">, http.StatusBadRequest)</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">	} </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">_err</span><span style="color:#D4D4D4;"> := json.</span><span style="color:#DCDCAA;">NewDecoder</span><span style="color:#D4D4D4;">(_req.Body).</span><span style="color:#DCDCAA;">Decode</span><span style="color:#D4D4D4;">(&amp;payload); _err != </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">			http.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(_writer, _err.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(), http.StatusBadRequest)</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">		} </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">_err</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">ValidateStruct</span><span style="color:#D4D4D4;">(payload); _err != </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">				http.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(_writer, _err.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(), http.StatusBadRequest)</span></span>
<span class="line"><span style="color:#D4D4D4;">				</span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">			}</span></span>
<span class="line"><span style="color:#D4D4D4;">		}</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> (receiver *ArticleHandlerImpl) </span><span style="color:#DCDCAA;">Article</span><span style="color:#D4D4D4;">(_writer http.ResponseWriter, _req *http.Request) {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#569CD6;">var</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">ctx</span><span style="color:#D4D4D4;">    context.Context</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">file</span><span style="color:#D4D4D4;">   *v3.FileModel</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">title</span><span style="color:#D4D4D4;">  *</span><span style="color:#4EC9B0;">string</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">content</span><span style="color:#D4D4D4;">    *</span><span style="color:#4EC9B0;">string</span></span>
<span class="line"><span style="color:#D4D4D4;">		tags   *[]</span><span style="color:#4EC9B0;">string</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">sort</span><span style="color:#D4D4D4;">   *</span><span style="color:#4EC9B0;">int</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">status</span><span style="color:#D4D4D4;"> *</span><span style="color:#4EC9B0;">int</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;">     *</span><span style="color:#4EC9B0;">int</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">   </span><span style="color:#4EC9B0;">string</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">err</span><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">error</span></span>
<span class="line"><span style="color:#D4D4D4;">	)</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">_</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">exists</span><span style="color:#D4D4D4;"> := _req.Form[</span><span style="color:#CE9178;">&quot;title&quot;</span><span style="color:#D4D4D4;">]; exists {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">_title</span><span style="color:#D4D4D4;"> := _req.</span><span style="color:#DCDCAA;">FormValue</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;title&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">title</span><span style="color:#D4D4D4;"> = &amp;_title</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">_err</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">ValidateVar</span><span style="color:#D4D4D4;">(title, </span><span style="color:#CE9178;">&quot;gt=0,lte=60&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;title&quot;</span><span style="color:#D4D4D4;">); _err != </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">			http.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(_writer, _err.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(), http.StatusBadRequest)</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">		}</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">_</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">exists</span><span style="color:#D4D4D4;"> := _req.Form[</span><span style="color:#CE9178;">&quot;content&quot;</span><span style="color:#D4D4D4;">]; exists {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">_content</span><span style="color:#D4D4D4;"> := _req.</span><span style="color:#DCDCAA;">FormValue</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;content&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">content</span><span style="color:#D4D4D4;"> = &amp;_content</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">_err</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">ValidateVar</span><span style="color:#D4D4D4;">(content, </span><span style="color:#CE9178;">&quot;gt=0,lte=1000&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;content&quot;</span><span style="color:#D4D4D4;">); _err != </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">			http.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(_writer, _err.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(), http.StatusBadRequest)</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">		}</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>\u9519\u8BEF\u4FE1\u606F\u4E2D\u6587\u7FFB\u8BD1\u793A\u4F8B</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">package</span><span style="color:#D4D4D4;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">import</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;github.com/go-playground/locales/zh&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	ut </span><span style="color:#CE9178;">&quot;github.com/go-playground/universal-translator&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	zhtrans </span><span style="color:#CE9178;">&quot;github.com/go-playground/validator/v10/translations/zh&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">uni</span><span style="color:#D4D4D4;"> := ut.</span><span style="color:#DCDCAA;">New</span><span style="color:#D4D4D4;">(zh.</span><span style="color:#DCDCAA;">New</span><span style="color:#D4D4D4;">())</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">trans</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">_</span><span style="color:#D4D4D4;"> := uni.</span><span style="color:#DCDCAA;">GetTranslator</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;zh&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">	rest.</span><span style="color:#DCDCAA;">SetTranslator</span><span style="color:#D4D4D4;">(trans)</span></span>
<span class="line"><span style="color:#D4D4D4;">	zhtrans.</span><span style="color:#DCDCAA;">RegisterDefaultTranslations</span><span style="color:#D4D4D4;">(rest.</span><span style="color:#DCDCAA;">GetValidate</span><span style="color:#D4D4D4;">(), trans)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div>`,10);function Ts(Os,Ls){const l=p("ExternalLinkIcon"),o=p("RouterLink");return r(),c(D,null,[C,s("ul",null,[s("li",null,[s("p",null,[m,h,s("a",A,[E,a(l)])])]),s("li",null,[s("p",null,[g,v,s("a",_,[f,a(l)])])]),R,k,s("li",null,[s("p",null,[q,x,S,F,s("a",N,[w,a(l)])])]),G]),P,s("p",null,[B,I,s("a",V,[M,a(l)]),T]),O,s("p",null,[L,z,s("a",W,[H,a(l)]),j]),Y,s("p",null,[U,J,K,Z,s("a",Q,[X,a(l)]),$]),ss,s("p",null,[ns,as,s("a",ls,[es,a(l)]),ps]),os,s("p",null,[rs,s("a",cs,[ts,a(l)]),Ds]),is,ys,s("ol",null,[ds,s("li",null,[us,bs,Cs,a(o,{to:"/zh/guide/idl.html#%E6%B3%A8%E8%A7%A3"},{default:t(()=>[ms]),_:1}),hs]),As]),Es,s("p",null,[gs,vs,_s,fs,Rs,ks,qs,xs,Ss,Fs,Ns,s("a",ws,[Gs,a(l)]),Ps,s("a",Bs,[Is,a(l)]),Vs]),Ms],64)}var Ys=u(b,[["render",Ts]]);export{Ys as default};
