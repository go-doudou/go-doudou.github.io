import{r as p,o as r,a as t,b as s,e as a,w as c,F as D,g as l,f as n}from"./app.2025f35b.js";import{_ as i}from"./elk.d2b0578e.js";import{_ as d,a as y}from"./jaeger2.579239e1.js";import{_ as u}from"./plugin-vue_export-helper.21dcd24c.js";const b={},m=l(`<h1 id="rest" tabindex="-1"><a class="header-anchor" href="#rest" aria-hidden="true">#</a> REST</h1><h2 id="built-in-routes" tabindex="-1"><a class="header-anchor" href="#built-in-routes" aria-hidden="true">#</a> Built-in Routes</h2><p>The go-doudou framework has 12 built-in routes, which facilitate debugging between service developers and callers, monitoring of service status by service developers, and optimization of online services.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetDoc               | GET    | /go-doudou/doc          |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetOpenAPI           | GET    | /go-doudou/openapi.json |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | Prometheus           | GET    | /go-doudou/prometheus   |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetConfig            | GET    | /go-doudou/config       |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetStatsvizWs        | GET    | /go-doudou/statsviz/ws  |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetStatsviz          | GET    | /go-doudou/statsviz/*   |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetDebugPprofCmdline | GET    | /debug/pprof/cmdline    |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetDebugPprofProfile | GET    | /debug/pprof/profile    |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetDebugPprofSymbol  | GET    | /debug/pprof/symbol     |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetDebugPprofTrace   | GET    | /debug/pprof/trace      |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF | GetDebugPprofIndex   | GET    | /debug/pprof/*          |</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF +----------------------+--------+-------------------------+</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF ===================================================</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF Http server is listening at :6060</span></span>
<span class="line"><span style="color:#D4D4D4;">2022-11-07 23:11:43 INF Http server started </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> 1.676754ms      </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Here&#39;s a detailed explanation of each route:</p>`,5),C=s("code",null,"/go-doudou/doc",-1),h=n(": An online interface documentation based on OpenAPI 3.0 specification, developed using vuejs+elementUI. The core code is open source and can be used separately after compilation, especially for other frameworks and programming languages. Repository: "),g={href:"https://github.com/unionj-cloud/go-doudou-openapi-ui",target:"_blank",rel:"noopener noreferrer"},v=n("https://github.com/unionj-cloud/go-doudou-openapi-ui"),A=s("code",null,"/go-doudou/openapi.json",-1),E=n(": A json document compatible with OpenAPI 3.0 specification, mainly used for third-party code generation tools that also support OpenAPI 3.0 to generate code, such as the pullcode http request client code generator for typescript developed by the go-doudou author in Nodejs. Repository: "),f={href:"https://github.com/wubin1989/pullcode",target:"_blank",rel:"noopener noreferrer"},_=n("https://github.com/wubin1989/pullcode"),R=s("li",null,[s("p",null,[s("code",null,"/go-doudou/prometheus"),n(": Used for Prometheus to crawl service operation metrics")])],-1),k=s("li",null,[s("p",null,[s("code",null,"/go-doudou/config"),n(": Used to view the environment configuration of the current running service. You can add a query string parameter "),s("code",null,"pre"),n(", for example: "),s("code",null,"http://localhost:6066/go-doudou/config?pre=GDD_"),n(", which means only display environment variables with the prefix "),s("code",null,"GDD_")])],-1),w=s("code",null,"/go-doudou/statsviz/ws",-1),x=n(" and "),q=s("code",null,"/go-doudou/statsviz/*",-1),S=n(": Integrated with the open source library "),F={href:"https://github.com/arl/statsviz",target:"_blank",rel:"noopener noreferrer"},N=n("https://github.com/arl/statsviz"),P=n(" for visualizing runtime statistics"),G=s("li",null,[s("p",null,[n("Routes with the prefix "),s("code",null,"/debug/"),n(": Integrated with Go's built-in pprof tool, can be used when optimizing programs. Here are some common usages:")])],-1),T=l(`<div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">go tool pprof -http :6068 http://admin:admin@localhost:6060/debug/pprof/profile</span><span style="color:#D7BA7D;">\\?</span><span style="color:#D4D4D4;">seconds</span><span style="color:#D7BA7D;">\\=</span><span style="color:#D4D4D4;">20</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>After waiting 20 seconds, a browser will automatically open where you can view flame graphs, etc.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">curl -o trace.out http://qylz:1234@localhost:6060/debug/pprof/trace</span><span style="color:#D7BA7D;">\\?</span><span style="color:#D4D4D4;">seconds</span><span style="color:#D7BA7D;">\\=</span><span style="color:#D4D4D4;">20</span></span>
<span class="line"><span style="color:#D4D4D4;">go tool trace trace.out</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>After executing these two commands, a browser will automatically open, and you can view the monitoring indicators of the program&#39;s operation during the first 20 seconds.</p><p>Additionally, all built-in routes have HTTP basic auth verification. You can customize the username and password through the environment variables <code>GDD_MANAGE_USER</code> and <code>GDD_MANAGE_PASS</code>, with default values both being <code>admin</code>. If you use a configuration management center supported by go-doudou such as Nacos or Apollo, you can dynamically modify them at runtime, which will take effect automatically without restarting the service. It is recommended to change the HTTP basic username and password of the service in the production environment every now and then to ensure security.</p><h2 id="service-registration-and-discovery" tabindex="-1"><a class="header-anchor" href="#service-registration-and-discovery" aria-hidden="true">#</a> Service Registration and Discovery</h2><p><code>go-doudou</code> supports two service registration and discovery mechanisms: <code>etcd</code> and <code>nacos</code>. REST services registered in the registry will automatically have the <code>_rest</code> suffix added to their service name, and gRPC services will have the <code>_grpc</code> suffix, to distinguish between them.</p><div class="custom-container tip"><p class="custom-container-title">Tip</p><p>The <code>etcd</code> and <code>nacos</code> mechanisms can be used simultaneously in one service</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_DISCOVERY_MODE=etcd,nacos</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><h3 id="etcd" tabindex="-1"><a class="header-anchor" href="#etcd" aria-hidden="true">#</a> Etcd</h3><p><code>go-doudou</code> has built-in support for using etcd as a registry center for service registration and discovery since v2. The following environment variables need to be configured:</p><ul><li><code>GDD_SERVICE_NAME</code>: Service name, required</li><li><code>GDD_SERVICE_DISCOVERY_MODE</code>: Service registration and discovery mechanism name, <code>etcd</code>, required</li><li><code>GDD_ETCD_ENDPOINTS</code>: etcd connection address, required</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_NAME=grpcdemo-server</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_DISCOVERY_MODE=etcd</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_ETCD_ENDPOINTS=localhost:2379</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="nacos" tabindex="-1"><a class="header-anchor" href="#nacos" aria-hidden="true">#</a> Nacos</h3><p><code>go-doudou</code> has built-in support for using Alibaba&#39;s Nacos as a registry center for service registration and discovery. The following environment variables need to be configured:</p><ul><li><code>GDD_SERVICE_NAME</code>: Service name, required</li><li><code>GDD_NACOS_SERVER_ADDR</code>: Nacos server address, required</li><li><code>GDD_SERVICE_DISCOVERY_MODE</code>: Service discovery mechanism name, required</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_NAME=test-svc </span><span style="color:#6A9955;"># Required</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_NACOS_SERVER_ADDR=http://localhost:8848/nacos </span><span style="color:#6A9955;"># Required</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_DISCOVERY_MODE=nacos </span><span style="color:#6A9955;"># Required</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="zookeeper" tabindex="-1"><a class="header-anchor" href="#zookeeper" aria-hidden="true">#</a> Zookeeper</h3><p><code>go-doudou</code> has built-in support for using Zookeeper as a registry center for service registration and discovery. The following environment variables need to be configured:</p><ul><li><code>GDD_SERVICE_NAME</code>: Service name, required</li><li><code>GDD_SERVICE_DISCOVERY_MODE</code>: Service discovery mechanism name, required</li><li><code>GDD_ZK_SERVERS</code>: Zookeeper server address, required</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_NAME=cloud.unionj.ServiceB </span><span style="color:#6A9955;"># Required</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_DISCOVERY_MODE=zk </span><span style="color:#6A9955;"># Required</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_ZK_SERVERS=localhost:2181 </span><span style="color:#6A9955;"># Required</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_ZK_DIRECTORY_PATTERN=/dubbo/%s/providers</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_GROUP=group</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_VERSION=v2.2.2</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="client-side-load-balancing" tabindex="-1"><a class="header-anchor" href="#client-side-load-balancing" aria-hidden="true">#</a> Client-side Load Balancing</h2><h3 id="simple-round-robin-load-balancing-for-etcd" tabindex="-1"><a class="header-anchor" href="#simple-round-robin-load-balancing-for-etcd" aria-hidden="true">#</a> Simple Round Robin Load Balancing (For Etcd)</h3><p>You need to call <code>etcd.NewRRServiceProvider(&quot;service name registered in etcd&quot;)</code> to create an <code>etcd.RRServiceProvider</code> instance.</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> etcd.</span><span style="color:#DCDCAA;">CloseEtcdClient</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">conf</span><span style="color:#D4D4D4;"> := config.</span><span style="color:#DCDCAA;">LoadFromEnv</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">restProvider</span><span style="color:#D4D4D4;"> := etcd.</span><span style="color:#DCDCAA;">NewRRServiceProvider</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;grpcdemo-server_rest&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewEnumDemo</span><span style="color:#D4D4D4;">(conf, client.</span><span style="color:#DCDCAA;">NewHelloworldClient</span><span style="color:#D4D4D4;">(restclient.</span><span style="color:#DCDCAA;">WithProvider</span><span style="color:#D4D4D4;">(restProvider)))</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewEnumDemoHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="smooth-weighted-round-robin-load-balancing-for-etcd" tabindex="-1"><a class="header-anchor" href="#smooth-weighted-round-robin-load-balancing-for-etcd" aria-hidden="true">#</a> Smooth Weighted Round Robin Load Balancing (For Etcd)</h3><p>You need to call <code>etcd.NewSWRRServiceProvider(&quot;service name registered in etcd&quot;)</code> to create an <code>etcd.SWRRServiceProvider</code> instance.</p><p>If the environment variable <code>GDD_WEIGHT</code> is not set, the default weight is 1.</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> etcd.</span><span style="color:#DCDCAA;">CloseEtcdClient</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">conf</span><span style="color:#D4D4D4;"> := config.</span><span style="color:#DCDCAA;">LoadFromEnv</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">restProvider</span><span style="color:#D4D4D4;"> := etcd.</span><span style="color:#DCDCAA;">NewSWRRServiceProvider</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;grpcdemo-server_rest&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewEnumDemo</span><span style="color:#D4D4D4;">(conf, client.</span><span style="color:#DCDCAA;">NewHelloworldClient</span><span style="color:#D4D4D4;">(restclient.</span><span style="color:#DCDCAA;">WithProvider</span><span style="color:#D4D4D4;">(restProvider)))</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewEnumDemoHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="simple-round-robin-load-balancing-for-nacos" tabindex="-1"><a class="header-anchor" href="#simple-round-robin-load-balancing-for-nacos" aria-hidden="true">#</a> Simple Round Robin Load Balancing (For Nacos)</h3><p>You need to call <code>nacos.NewRRServiceProvider(&quot;service name registered in nacos&quot;)</code> to create a <code>nacos.RRServiceProvider</code> instance.</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> nacos.</span><span style="color:#DCDCAA;">CloseNamingClient</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">conf</span><span style="color:#D4D4D4;"> := config.</span><span style="color:#DCDCAA;">LoadFromEnv</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">restProvider</span><span style="color:#D4D4D4;"> := nacos.</span><span style="color:#DCDCAA;">NewRRServiceProvider</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;grpcdemo-server_rest&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewEnumDemo</span><span style="color:#D4D4D4;">(conf, client.</span><span style="color:#DCDCAA;">NewHelloworldClient</span><span style="color:#D4D4D4;">(restclient.</span><span style="color:#DCDCAA;">WithProvider</span><span style="color:#D4D4D4;">(restProvider)))</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewEnumDemoHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="weighted-round-robin-load-balancing-for-nacos" tabindex="-1"><a class="header-anchor" href="#weighted-round-robin-load-balancing-for-nacos" aria-hidden="true">#</a> Weighted Round Robin Load Balancing (For Nacos)</h3><p>You need to call <code>nacos.NewWRRServiceProvider(&quot;service name registered in nacos&quot;)</code> to create a <code>nacos.WRRServiceProvider</code> instance.</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> nacos.</span><span style="color:#DCDCAA;">CloseNamingClient</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">conf</span><span style="color:#D4D4D4;"> := config.</span><span style="color:#DCDCAA;">LoadFromEnv</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">restProvider</span><span style="color:#D4D4D4;"> := nacos.</span><span style="color:#DCDCAA;">NewWRRServiceProvider</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;grpcdemo-server_rest&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewEnumDemo</span><span style="color:#D4D4D4;">(conf, client.</span><span style="color:#DCDCAA;">NewHelloworldClient</span><span style="color:#D4D4D4;">(restclient.</span><span style="color:#DCDCAA;">WithProvider</span><span style="color:#D4D4D4;">(restProvider)))</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewEnumDemoHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="simple-round-robin-load-balancing-for-zookeeper" tabindex="-1"><a class="header-anchor" href="#simple-round-robin-load-balancing-for-zookeeper" aria-hidden="true">#</a> Simple Round Robin Load Balancing (For Zookeeper)</h3><p>You need to call <code>zk.NewRRServiceProvider(&quot;service name registered in zookeeper&quot;)</code> to create a <code>zk.RRServiceProvider</code> instance.</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">provider</span><span style="color:#D4D4D4;"> := zk.</span><span style="color:#DCDCAA;">NewRRServiceProvider</span><span style="color:#D4D4D4;">(zk.ServiceConfig{</span></span>
<span class="line"><span style="color:#D4D4D4;">		Name:    </span><span style="color:#CE9178;">&quot;cloud.unionj.ServiceB_rest&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">		Group:   </span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">		Version: </span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> provider.</span><span style="color:#DCDCAA;">Close</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">bClient</span><span style="color:#D4D4D4;"> := client.</span><span style="color:#DCDCAA;">NewServiceBClient</span><span style="color:#D4D4D4;">(restclient.</span><span style="color:#DCDCAA;">WithProvider</span><span style="color:#D4D4D4;">(provider))</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="weighted-round-robin-load-balancing-for-zookeeper" tabindex="-1"><a class="header-anchor" href="#weighted-round-robin-load-balancing-for-zookeeper" aria-hidden="true">#</a> Weighted Round Robin Load Balancing (For Zookeeper)</h3><p>You need to call <code>zk.NewSWRRServiceProvider(&quot;service name registered in zookeeper&quot;)</code> to create a <code>zk.NewSWRRServiceProvider</code> instance.</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">provider</span><span style="color:#D4D4D4;"> := zk.</span><span style="color:#DCDCAA;">NewSWRRServiceProvider</span><span style="color:#D4D4D4;">(zk.ServiceConfig{</span></span>
<span class="line"><span style="color:#D4D4D4;">		Name:    </span><span style="color:#CE9178;">&quot;cloud.unionj.ServiceB_rest&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">		Group:   </span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">		Version: </span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> provider.</span><span style="color:#DCDCAA;">Close</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">bClient</span><span style="color:#D4D4D4;"> := client.</span><span style="color:#DCDCAA;">NewServiceBClient</span><span style="color:#D4D4D4;">(restclient.</span><span style="color:#DCDCAA;">WithProvider</span><span style="color:#D4D4D4;">(provider))</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="rate-limiting" tabindex="-1"><a class="header-anchor" href="#rate-limiting" aria-hidden="true">#</a> Rate Limiting</h2><h3 id="usage" tabindex="-1"><a class="header-anchor" href="#usage" aria-hidden="true">#</a> Usage</h3>`,42),B=s("code",null,"go-doudou",-1),I=n(" has built-in memory rate limiters based on the token bucket algorithm implemented with "),L={href:"https://pkg.go.dev/golang.org/x/time/rate",target:"_blank",rel:"noopener noreferrer"},V=n("golang.org/x/time/rate"),M=n("."),H=l("<p>In the <code>github.com/unionj-cloud/go-doudou/v2/framework/ratelimit/memrate</code> package, there is a <code>MemoryStore</code> struct that stores key and <code>Limiter</code> instance pairs. The <code>Limiter</code> instance is a rate limiter instance, and the key is the key for that rate limiter instance.</p><p>You can pass an optional function <code>memrate.WithTimer</code> to the <code>memrate.NewLimiter</code> factory function to set a callback function for when the key&#39;s idle time exceeds <code>timeout</code>, for example, to delete the key from the <code>MemoryStore</code> instance to free up memory resources.</p>",2),z=s("code",null,"go-doudou",-1),O=n(" also provides a redis rate limiter based on the GCRA rate limiting algorithm wrapped with the "),W={href:"https://github.com/go-redis/redis_rate",target:"_blank",rel:"noopener noreferrer"},j=n("go-redis/redis_rate"),Y=n(" library. This rate limiter supports cross-instance global rate limiting."),U=l(`<h3 id="memory-rate-limiter-example" tabindex="-1"><a class="header-anchor" href="#memory-rate-limiter-example" aria-hidden="true">#</a> Memory Rate Limiter Example</h3><p>The memory rate limiter is based on local memory and only supports local rate limiting.</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">store</span><span style="color:#D4D4D4;"> := memrate.</span><span style="color:#DCDCAA;">NewMemoryStore</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(_ context.Context, store *memrate.MemoryStore, key </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">) ratelimit.Limiter {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> memrate.</span><span style="color:#DCDCAA;">NewLimiter</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">30</span><span style="color:#D4D4D4;">, memrate.</span><span style="color:#DCDCAA;">WithTimer</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">*time.Second, </span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">			store.</span><span style="color:#DCDCAA;">DeleteKey</span><span style="color:#D4D4D4;">(key)</span></span>
<span class="line"><span style="color:#D4D4D4;">		}))</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddMiddleware</span><span style="color:#D4D4D4;">(</span></span>
<span class="line"><span style="color:#D4D4D4;">		httpsrv.</span><span style="color:#DCDCAA;">RateLimit</span><span style="color:#D4D4D4;">(store),</span></span>
<span class="line"><span style="color:#D4D4D4;">	)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewUsersvcHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewUsersvcHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>Note:</strong> You need to implement the HTTP middleware yourself. Here&#39;s an example.</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">// RateLimit limits rate based on memrate.MemoryStore</span></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">RateLimit</span><span style="color:#D4D4D4;">(store *memrate.MemoryStore) </span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(inner http.Handler) http.Handler {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(inner http.Handler) http.Handler {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> http.</span><span style="color:#DCDCAA;">HandlerFunc</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(w http.ResponseWriter, r *http.Request) {</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#9CDCFE;">key</span><span style="color:#D4D4D4;"> := r.RemoteAddr[:strings.</span><span style="color:#DCDCAA;">LastIndex</span><span style="color:#D4D4D4;">(r.RemoteAddr, </span><span style="color:#CE9178;">&quot;:&quot;</span><span style="color:#D4D4D4;">)]</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#9CDCFE;">limiter</span><span style="color:#D4D4D4;"> := store.</span><span style="color:#DCDCAA;">GetLimiter</span><span style="color:#D4D4D4;">(key)</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> !limiter.</span><span style="color:#DCDCAA;">Allow</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">				http.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(w, </span><span style="color:#CE9178;">&quot;too many requests&quot;</span><span style="color:#D4D4D4;">, http.StatusTooManyRequests)</span></span>
<span class="line"><span style="color:#D4D4D4;">				</span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">			}</span></span>
<span class="line"><span style="color:#D4D4D4;">			inner.</span><span style="color:#DCDCAA;">ServeHTTP</span><span style="color:#D4D4D4;">(w, r)</span></span>
<span class="line"><span style="color:#D4D4D4;">		})</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="redis-rate-limiter-example" tabindex="-1"><a class="header-anchor" href="#redis-rate-limiter-example" aria-hidden="true">#</a> Redis Rate Limiter Example</h3><p>Redis rate limiters can be used in scenarios where multiple instances need to rate limit a key at the same time.</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewWordcloudBff</span><span style="color:#D4D4D4;">(conf, minioClient, makerClientProxy, taskClientProxy, userClientProxy)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewWordcloudBffHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddMiddleware</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Auth</span><span style="color:#D4D4D4;">(userClientProxy))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">rdb</span><span style="color:#D4D4D4;"> := redis.</span><span style="color:#DCDCAA;">NewClient</span><span style="color:#D4D4D4;">(&amp;redis.Options{</span></span>
<span class="line"><span style="color:#D4D4D4;">		Addr: fmt.</span><span style="color:#DCDCAA;">Sprintf</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;</span><span style="color:#9CDCFE;">%s</span><span style="color:#CE9178;">:6379&quot;</span><span style="color:#D4D4D4;">, conf.RedisConf.Host),</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">fn</span><span style="color:#D4D4D4;"> := redisrate.</span><span style="color:#DCDCAA;">LimitFn</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(ctx context.Context) ratelimit.Limit {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> ratelimit.</span><span style="color:#DCDCAA;">PerSecondBurst</span><span style="color:#D4D4D4;">(conf.ConConf.RatelimitRate, conf.ConConf.RatelimitBurst)</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddMiddleware</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">RedisRateLimit</span><span style="color:#D4D4D4;">(rdb, fn))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong>Note:</strong> You need to implement the HTTP middleware yourself. Here&#39;s an example.</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">// RedisRateLimit limits rate based on redisrate.GcraLimiter</span></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">RedisRateLimit</span><span style="color:#D4D4D4;">(rdb redisrate.Rediser, fn redisrate.LimitFn) </span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(inner http.Handler) http.Handler {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(inner http.Handler) http.Handler {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> http.</span><span style="color:#DCDCAA;">HandlerFunc</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(w http.ResponseWriter, r *http.Request) {</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#9CDCFE;">userId</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">_</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">UserIdFromContext</span><span style="color:#D4D4D4;">(r.</span><span style="color:#DCDCAA;">Context</span><span style="color:#D4D4D4;">())</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#9CDCFE;">limiter</span><span style="color:#D4D4D4;"> := redisrate.</span><span style="color:#DCDCAA;">NewGcraLimiterLimitFn</span><span style="color:#D4D4D4;">(rdb, strconv.</span><span style="color:#DCDCAA;">Itoa</span><span style="color:#D4D4D4;">(userId), fn)</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> !limiter.</span><span style="color:#DCDCAA;">Allow</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">				http.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(w, </span><span style="color:#CE9178;">&quot;too many requests&quot;</span><span style="color:#D4D4D4;">, http.StatusTooManyRequests)</span></span>
<span class="line"><span style="color:#D4D4D4;">				</span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">			}</span></span>
<span class="line"><span style="color:#D4D4D4;">			inner.</span><span style="color:#DCDCAA;">ServeHTTP</span><span style="color:#D4D4D4;">(w, r)</span></span>
<span class="line"><span style="color:#D4D4D4;">		})</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="bulkhead" tabindex="-1"><a class="header-anchor" href="#bulkhead" aria-hidden="true">#</a> Bulkhead</h2><h3 id="usage-1" tabindex="-1"><a class="header-anchor" href="#usage-1" aria-hidden="true">#</a> Usage</h3>`,12),Z=s("code",null,"go-doudou",-1),J=n(" has built-in ready-to-use bulkhead functionality in the "),K=s("code",null,"github.com/unionj-cloud/go-doudou/v2/framework/rest",-1),Q=n(" package, encapsulated based on "),X={href:"https://github.com/slok/goresilience",target:"_blank",rel:"noopener noreferrer"},$=n("github.com/slok/goresilience"),ss=n("."),ns=l(`<div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">rest.</span><span style="color:#DCDCAA;">BulkHead</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">*time.Millisecond)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>In the example code above, the first parameter <code>3</code> indicates the number of workers in the goroutine pool used to process HTTP requests, and the second parameter <code>10*time.Millisecond</code> indicates the maximum waiting time for an HTTP request after it comes in. If it times out, it directly returns a <code>429</code> status code.</p><h3 id="example" tabindex="-1"><a class="header-anchor" href="#example" aria-hidden="true">#</a> Example</h3><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewWordcloudBff</span><span style="color:#D4D4D4;">(conf, minioClient, makerClientProxy, taskClientProxy, userClientProxy)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewWordcloudBffHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddMiddleware</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Auth</span><span style="color:#D4D4D4;">(userClientProxy))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">rdb</span><span style="color:#D4D4D4;"> := redis.</span><span style="color:#DCDCAA;">NewClient</span><span style="color:#D4D4D4;">(&amp;redis.Options{</span></span>
<span class="line"><span style="color:#D4D4D4;">		Addr: fmt.</span><span style="color:#DCDCAA;">Sprintf</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;</span><span style="color:#9CDCFE;">%s</span><span style="color:#CE9178;">:6379&quot;</span><span style="color:#D4D4D4;">, conf.RedisConf.Host),</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">fn</span><span style="color:#D4D4D4;"> := redisrate.</span><span style="color:#DCDCAA;">LimitFn</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;">(ctx context.Context) ratelimit.Limit {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> ratelimit.</span><span style="color:#DCDCAA;">PerSecondBurst</span><span style="color:#D4D4D4;">(conf.ConConf.RatelimitRate, conf.ConConf.RatelimitBurst)</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddMiddleware</span><span style="color:#D4D4D4;">(rest.</span><span style="color:#DCDCAA;">BulkHead</span><span style="color:#D4D4D4;">(conf.ConConf.BulkheadWorkers, conf.ConConf.BulkheadMaxwaittime))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="circuit-breaker-timeout-retry" tabindex="-1"><a class="header-anchor" href="#circuit-breaker-timeout-retry" aria-hidden="true">#</a> Circuit Breaker / Timeout / Retry</h2><h3 id="usage-2" tabindex="-1"><a class="header-anchor" href="#usage-2" aria-hidden="true">#</a> Usage</h3>`,6),as=s("code",null,"go-doudou",-1),es=n(" has built-in code for circuit breaker/timeout/retry and other resilience mechanisms encapsulated based on "),ls={href:"https://github.com/slok/goresilience",target:"_blank",rel:"noopener noreferrer"},ps=n("github.com/slok/goresilience"),os=n(" in the generated client code. You just need to execute the following command to generate client code to use:"),rs=l(`<div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">go-doudou svc http -c</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>The <code>-c</code> parameter indicates generating Go language client code. The directory structure of the generated <code>client</code> package is as follows:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">\u251C\u2500\u2500 client.go</span></span>
<span class="line"><span style="color:#D4D4D4;">\u251C\u2500\u2500 clientproxy.go</span></span>
<span class="line"><span style="color:#D4D4D4;">\u2514\u2500\u2500 iclient.go</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>The generated code already has a default <code>goresilience.Runner</code> instance, and you can also pass in a custom implementation through the <code>WithRunner(your_own_runner goresilience.Runner)</code> function.</p><h3 id="example-1" tabindex="-1"><a class="header-anchor" href="#example-1" aria-hidden="true">#</a> Example</h3><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">conf</span><span style="color:#D4D4D4;"> := config.</span><span style="color:#DCDCAA;">LoadFromEnv</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#569CD6;">var</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">segClient</span><span style="color:#D4D4D4;"> *segclient.WordcloudSegClient</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> os.</span><span style="color:#DCDCAA;">Getenv</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;GDD_SERVICE_DISCOVERY_MODE&quot;</span><span style="color:#D4D4D4;">) != </span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">provider</span><span style="color:#D4D4D4;"> := etcd.</span><span style="color:#DCDCAA;">NewSWRRServiceProvider</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;wordcloud-segsvc_rest&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">segClient</span><span style="color:#D4D4D4;"> = segclient.</span><span style="color:#DCDCAA;">NewWordcloudSegClient</span><span style="color:#D4D4D4;">(restclient.</span><span style="color:#DCDCAA;">WithProvider</span><span style="color:#D4D4D4;">(provider))</span></span>
<span class="line"><span style="color:#D4D4D4;">	} </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">segClient</span><span style="color:#D4D4D4;"> = segclient.</span><span style="color:#DCDCAA;">NewWordcloudSegClient</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">segClientProxy</span><span style="color:#D4D4D4;"> := segclient.</span><span style="color:#DCDCAA;">NewWordcloudSegClientProxy</span><span style="color:#D4D4D4;">(segClient)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	... </span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewWordcloudMaker</span><span style="color:#D4D4D4;">(conf, segClientProxy, minioClient, browser)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="logging" tabindex="-1"><a class="header-anchor" href="#logging" aria-hidden="true">#</a> Logging</h2><h3 id="usage-3" tabindex="-1"><a class="header-anchor" href="#usage-3" aria-hidden="true">#</a> Usage</h3><p><code>go-doudou</code> has a global <code>zerolog.Logger</code> built into the <code>github.com/unionj-cloud/go-doudou/v2/toolkit/zlogger</code> package. If the <code>GDD_ENV</code> environment variable is not equal to an empty string and <code>dev</code>, it will include some metadata about the service itself.</p><p>You can also call the <code>InitEntry</code> function to customize the <code>zerolog.Logger</code> instance.</p><p>You can also set the log level by configuring the <code>GDD_LOG_LEVEL</code> environment variable, and set whether the log format is <code>json</code> or <code>text</code> by configuring the <code>GDD_LOG_FORMAT</code> environment variable.</p><p>You can enable HTTP request and response log printing by configuring <code>GDD_LOG_REQ_ENABLE=true</code>. The default is <code>false</code>, which means no printing.</p><h3 id="example-2" tabindex="-1"><a class="header-anchor" href="#example-2" aria-hidden="true">#</a> Example</h3><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">// You can use the lumberjack library to add log rotation functionality to your service</span></span>
<span class="line"><span style="color:#D4D4D4;">zlogger.</span><span style="color:#DCDCAA;">SetOutput</span><span style="color:#D4D4D4;">(io.</span><span style="color:#DCDCAA;">MultiWriter</span><span style="color:#D4D4D4;">(os.Stdout, &amp;lumberjack.Logger{</span></span>
<span class="line"><span style="color:#D4D4D4;">			Filename:   filepath.</span><span style="color:#DCDCAA;">Join</span><span style="color:#D4D4D4;">(os.</span><span style="color:#DCDCAA;">Getenv</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;LOG_PATH&quot;</span><span style="color:#D4D4D4;">), fmt.</span><span style="color:#DCDCAA;">Sprintf</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;</span><span style="color:#9CDCFE;">%s</span><span style="color:#CE9178;">.log&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;usersvc&quot;</span><span style="color:#D4D4D4;">)),</span></span>
<span class="line"><span style="color:#D4D4D4;">		  MaxSize:    </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">,  </span><span style="color:#6A9955;">// Single log file maximum size is 5M, exceeding this will create a new log file</span></span>
<span class="line"><span style="color:#D4D4D4;">      MaxBackups: </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// Keep a maximum of 10 log files</span></span>
<span class="line"><span style="color:#D4D4D4;">      MaxAge:     </span><span style="color:#B5CEA8;">7</span><span style="color:#D4D4D4;">,  </span><span style="color:#6A9955;">// Log files are kept for a maximum of 7 days</span></span>
<span class="line"><span style="color:#D4D4D4;">      Compress:   </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">, </span><span style="color:#6A9955;">// Whether to enable log compression</span></span>
<span class="line"><span style="color:#D4D4D4;">}))</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="elk-stack" tabindex="-1"><a class="header-anchor" href="#elk-stack" aria-hidden="true">#</a> ELK Stack</h3><p>The <code>logger</code> package supports integration with the ELK stack.</p><h4 id="example-3" tabindex="-1"><a class="header-anchor" href="#example-3" aria-hidden="true">#</a> Example</h4><div class="language-yaml ext-yml line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">version</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&#39;3.9&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">services</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">elasticsearch</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">container_name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">elasticsearch</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">image</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;docker.elastic.co/elasticsearch/elasticsearch:7.2.0&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">environment</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">     - </span><span style="color:#CE9178;">&quot;ES_JAVA_OPTS=-Xms1g -Xmx1g&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">     - </span><span style="color:#CE9178;">&quot;discovery.type=single-node&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">ports</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">     - </span><span style="color:#CE9178;">&quot;9200:9200&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">volumes</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">     - </span><span style="color:#CE9178;">./esdata:/usr/share/elasticsearch/data</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">networks</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">     </span><span style="color:#569CD6;">testing_net</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">       </span><span style="color:#569CD6;">ipv4_address</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">172.28.1.9</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">kibana</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">container_name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">kibana</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">image</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;docker.elastic.co/kibana/kibana:7.2.0&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">ports</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">     - </span><span style="color:#CE9178;">&quot;5601:5601&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">networks</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">     </span><span style="color:#569CD6;">testing_net</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">       </span><span style="color:#569CD6;">ipv4_address</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">172.28.1.10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">filebeat</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">container_name</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">filebeat</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">image</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;docker.elastic.co/beats/filebeat:7.2.0&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">volumes</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">     - </span><span style="color:#CE9178;">./filebeat.yml:/usr/share/filebeat/filebeat.yml:ro</span></span>
<span class="line"><span style="color:#D4D4D4;">     - </span><span style="color:#CE9178;">./log:/var/log</span></span>
<span class="line"><span style="color:#D4D4D4;">   </span><span style="color:#569CD6;">networks</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">     </span><span style="color:#569CD6;">testing_net</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">       </span><span style="color:#569CD6;">ipv4_address</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">172.28.1.11</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">networks</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">testing_net</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">ipam</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">driver</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">default</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#569CD6;">config</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        - </span><span style="color:#569CD6;">subnet</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">172.28.0.0/16</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h4 id="screenshot" tabindex="-1"><a class="header-anchor" href="#screenshot" aria-hidden="true">#</a> Screenshot</h4><p><img src="`+i+`" alt="elk"></p><h2 id="jaeger-call-chain-monitoring" tabindex="-1"><a class="header-anchor" href="#jaeger-call-chain-monitoring" aria-hidden="true">#</a> Jaeger Call Chain Monitoring</h2><h3 id="usage-4" tabindex="-1"><a class="header-anchor" href="#usage-4" aria-hidden="true">#</a> Usage</h3><p>To integrate Jaeger call chain monitoring, follow these steps:</p><ol><li>Start Jaeger</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">docker run -d --name jaeger \\</span></span>
<span class="line"><span style="color:#D4D4D4;">  -p 6831:6831/udp \\</span></span>
<span class="line"><span style="color:#D4D4D4;">  -p 16686:16686 \\</span></span>
<span class="line"><span style="color:#D4D4D4;">  jaegertracing/all-in-one:1.29</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>Add two lines of configuration to the <code>.env</code> file</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">JAEGER_AGENT_HOST=localhost</span></span>
<span class="line"><span style="color:#D4D4D4;">JAEGER_AGENT_PORT=6831</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li>Add three lines of code near the beginning of the <code>main</code> function</li></ol><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#9CDCFE;">tracer</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">closer</span><span style="color:#D4D4D4;"> := tracing.</span><span style="color:#DCDCAA;">Init</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> closer.</span><span style="color:#DCDCAA;">Close</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">opentracing.</span><span style="color:#DCDCAA;">SetGlobalTracer</span><span style="color:#D4D4D4;">(tracer)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Then your <code>main</code> function should look something like this:</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">tracer</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">closer</span><span style="color:#D4D4D4;"> := tracing.</span><span style="color:#DCDCAA;">Init</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">defer</span><span style="color:#D4D4D4;"> closer.</span><span style="color:#DCDCAA;">Close</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	opentracing.</span><span style="color:#DCDCAA;">SetGlobalTracer</span><span style="color:#D4D4D4;">(tracer)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">svc</span><span style="color:#D4D4D4;"> := service.</span><span style="color:#DCDCAA;">NewWordcloudMaker</span><span style="color:#D4D4D4;">(conf, segClientProxy, minioClient, browser)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewWordcloudMakerHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="screenshots" tabindex="-1"><a class="header-anchor" href="#screenshots" aria-hidden="true">#</a> Screenshots</h3><p><img src="`+d+'" alt="jaeger1"><img src="'+y+`" alt="jaeger2"></p><h2 id="limiting-request-body-size" tabindex="-1"><a class="header-anchor" href="#limiting-request-body-size" aria-hidden="true">#</a> Limiting Request Body Size</h2><p>To ensure service stability and security, it is necessary to limit the size of the request body. We can implement this requirement using the <code>BodyMaxBytes</code> middleware in the <code>rest</code> package.</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">package</span><span style="color:#D4D4D4;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">import</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">handler</span><span style="color:#D4D4D4;"> := httpsrv.</span><span style="color:#DCDCAA;">NewOrdersvcHandler</span><span style="color:#D4D4D4;">(svc)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#6A9955;">// Limit request body size to no more than 32M</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Use</span><span style="color:#D4D4D4;">(rest.</span><span style="color:#DCDCAA;">BodyMaxBytes</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">32</span><span style="color:#D4D4D4;"> &lt;&lt; </span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">))</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddRoute</span><span style="color:#D4D4D4;">(httpsrv.</span><span style="color:#DCDCAA;">Routes</span><span style="color:#D4D4D4;">(handler)...)</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="gateway" tabindex="-1"><a class="header-anchor" href="#gateway" aria-hidden="true">#</a> Gateway</h2><p>In project practice, a frontend project may need to call multiple service interfaces, which can be inconvenient for frontend colleagues to configure. This is where gateway services come in handy. Frontend colleagues only need to configure one gateway service address in the configuration file, and then can request multiple different microservices through the <code>/service-name/interface-path</code> pattern. We can implement this requirement using the <code>Proxy</code> middleware in the <code>rest</code> package.</p><p>The gateway service must also register itself to the Nacos service registry or etcd cluster, or both.</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">package</span><span style="color:#D4D4D4;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">import</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;github.com/unionj-cloud/go-doudou/v2/framework/rest&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">srv</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">NewRestServer</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">AddMiddleware</span><span style="color:#D4D4D4;">(rest.</span><span style="color:#DCDCAA;">Proxy</span><span style="color:#D4D4D4;">(rest.ProxyConfig{}))</span></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>.env</code> configuration file example</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_NAME=gateway</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_SERVICE_DISCOVERY_MODE=nacos,etcd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># Nacos related configuration</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_NACOS_SERVER_ADDR=http://localhost:8848/nacos</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_NACOS_NOT_LOAD_CACHE_AT_START=true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># etcd related configuration</span></span>
<span class="line"><span style="color:#D4D4D4;">GDD_ETCD_ENDPOINTS=localhost:2379</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><em>Note:</em> For applications not developed with the go-doudou framework registered in the Nacos registry center, if they have a route prefix, it must be set in the <code>rootPath</code> property in the <code>metadata</code>, otherwise the gateway may report 404.</p><h2 id="request-body-and-request-parameter-validation" tabindex="-1"><a class="header-anchor" href="#request-body-and-request-parameter-validation" aria-hidden="true">#</a> Request Body and Request Parameter Validation</h2>`,44),ts=n("Since version v1.1.9, go-doudou has added a validation mechanism for request bodies and request parameters based on "),cs={href:"https://github.com/go-playground/validator",target:"_blank",rel:"noopener noreferrer"},Ds=n("go-playground/validator"),is=n("."),ds=s("h3",{id:"usage-5",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#usage-5","aria-hidden":"true"},"#"),n(" Usage")],-1),ys=s("p",null,"go-doudou's built-in request validation mechanism is as follows:",-1),us=s("li",null,"Pointer type parameters passed in the interface definition are optional parameters, while non-pointer type parameters are required parameters;",-1),bs=n("In the interface definition, you can add the "),ms=s("code",null,"@validate",-1),Cs=n(" annotation in the form of a Go language comment above the method parameters, following the annotation syntax and format described in the "),hs=n("Interface Definition-Annotations"),gs=n(" section, passing specific validation rules as parameters to the annotation;"),vs=s("li",null,[n("When defining struct structures in the vo package, you can add the "),s("code",null,"validate"),n(" tag in the property's tag, followed by specific validation rules;")],-1),As=s("p",null,[n("The validation rules mentioned in points 2 and 3 above only support the rules in the "),s("code",null,"go-playground/validator"),n(" library. The actual code for validating request bodies and request parameters in go-doudou is all in the "),s("code",null,"handlerimpl.go"),n(" file generated by the go-doudou command line tool. Only struct type (including struct pointer type) parameters are validated through the "),s("code",null,"func (v *Validate) Struct(s interface{}) error"),n(" method, while other types of parameters are validated through the "),s("code",null,"func (v *Validate) Var(field interface{}, tag string) error"),n(" method.")],-1),Es=n("go-doudou's "),fs=s("code",null,"ddhttp",-1),_s=n(" package provides a singleton of the "),Rs=s("code",null,"*validator.Validate",-1),ks=n(" type through the exported function "),ws=s("code",null,"func GetValidate() *validator.Validate",-1),xs=n(", which developers can use to call APIs provided directly by "),qs=s("code",null,"go-playground/validator",-1),Ss=n(" to implement more complex, custom requirements, such as Chinese translation of error messages, custom validation rules, etc. Please refer to "),Fs=s("code",null,"go-playground/validator",-1),Ns=n("'s "),Ps={href:"https://pkg.go.dev/github.com/go-playground/validator/v10",target:"_blank",rel:"noopener noreferrer"},Gs=n("official documentation"),Ts=n(" and "),Bs={href:"https://github.com/go-playground/validator/tree/master/_examples",target:"_blank",rel:"noopener noreferrer"},Is=n("official examples"),Ls=n("."),Vs=l(`<h3 id="example-4" tabindex="-1"><a class="header-anchor" href="#example-4" aria-hidden="true">#</a> Example</h3><p>Interface definition example</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">// &lt;b style=&quot;color: red&quot;&gt;NEW&lt;/b&gt; Article creation and update interface</span></span>
<span class="line"><span style="color:#6A9955;">// If there is an id in the passed parameters, the update operation is performed, otherwise the creation operation is performed</span></span>
<span class="line"><span style="color:#6A9955;">// @role(SUPER_ADMIN)</span></span>
<span class="line"><span style="color:#DCDCAA;">Article</span><span style="color:#D4D4D4;">(ctx context.Context, file *v3.FileModel,</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#6A9955;">// @validate(gt=0,lte=60)</span></span>
<span class="line"><span style="color:#D4D4D4;">	title,</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#6A9955;">// @validate(gt=0,lte=1000)</span></span>
<span class="line"><span style="color:#D4D4D4;">	content *</span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">, tags *[]</span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">, sort, status *</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">, id *</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">) (data </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">, err </span><span style="color:#4EC9B0;">error</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Struct structure example in the vo package</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">type</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">ArticleVo</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">struct</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">	Id      </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">\`json:&quot;id&quot;\`</span></span>
<span class="line"><span style="color:#D4D4D4;">	Title   </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">\`json:&quot;title&quot; validate:&quot;required,gt=0,lte=60&quot;\`</span></span>
<span class="line"><span style="color:#D4D4D4;">	Content </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">\`json:&quot;content&quot;\`</span></span>
<span class="line"><span style="color:#D4D4D4;">	Link    </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">\`json:&quot;link&quot; validate:&quot;required,url&quot;\`</span></span>
<span class="line"><span style="color:#D4D4D4;">	CreateAt </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">\`json:&quot;createAt&quot;\`</span></span>
<span class="line"><span style="color:#D4D4D4;">	UpdateAt </span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">\`json:&quot;updateAt&quot;\`</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Generated code example</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> (receiver *ArticleHandlerImpl) </span><span style="color:#DCDCAA;">ArticleList</span><span style="color:#D4D4D4;">(_writer http.ResponseWriter, _req *http.Request) {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#569CD6;">var</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">ctx</span><span style="color:#D4D4D4;">     context.Context</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">payload</span><span style="color:#D4D4D4;"> vo.ArticlePageQuery</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">    vo.ArticleRet</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">err</span><span style="color:#D4D4D4;">     </span><span style="color:#4EC9B0;">error</span></span>
<span class="line"><span style="color:#D4D4D4;">	)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">ctx</span><span style="color:#D4D4D4;"> = _req.</span><span style="color:#DCDCAA;">Context</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> _req.Body == </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">		http.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(_writer, </span><span style="color:#CE9178;">&quot;missing request body&quot;</span><span style="color:#D4D4D4;">, http.StatusBadRequest)</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">	} </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">_err</span><span style="color:#D4D4D4;"> := json.</span><span style="color:#DCDCAA;">NewDecoder</span><span style="color:#D4D4D4;">(_req.Body).</span><span style="color:#DCDCAA;">Decode</span><span style="color:#D4D4D4;">(&amp;payload); _err != </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">			http.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(_writer, _err.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(), http.StatusBadRequest)</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">		} </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">_err</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">ValidateStruct</span><span style="color:#D4D4D4;">(payload); _err != </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">				http.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(_writer, _err.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(), http.StatusBadRequest)</span></span>
<span class="line"><span style="color:#D4D4D4;">				</span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">			}</span></span>
<span class="line"><span style="color:#D4D4D4;">		}</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> (receiver *ArticleHandlerImpl) </span><span style="color:#DCDCAA;">Article</span><span style="color:#D4D4D4;">(_writer http.ResponseWriter, _req *http.Request) {</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#569CD6;">var</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">ctx</span><span style="color:#D4D4D4;">    context.Context</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">file</span><span style="color:#D4D4D4;">   *v3.FileModel</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">title</span><span style="color:#D4D4D4;">  *</span><span style="color:#4EC9B0;">string</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">content</span><span style="color:#D4D4D4;">    *</span><span style="color:#4EC9B0;">string</span></span>
<span class="line"><span style="color:#D4D4D4;">		tags   *[]</span><span style="color:#4EC9B0;">string</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">sort</span><span style="color:#D4D4D4;">   *</span><span style="color:#4EC9B0;">int</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">status</span><span style="color:#D4D4D4;"> *</span><span style="color:#4EC9B0;">int</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;">     *</span><span style="color:#4EC9B0;">int</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">data</span><span style="color:#D4D4D4;">   </span><span style="color:#4EC9B0;">string</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">err</span><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">error</span></span>
<span class="line"><span style="color:#D4D4D4;">	)</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">_</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">exists</span><span style="color:#D4D4D4;"> := _req.Form[</span><span style="color:#CE9178;">&quot;title&quot;</span><span style="color:#D4D4D4;">]; exists {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">_title</span><span style="color:#D4D4D4;"> := _req.</span><span style="color:#DCDCAA;">FormValue</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;title&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">title</span><span style="color:#D4D4D4;"> = &amp;_title</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">_err</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">ValidateVar</span><span style="color:#D4D4D4;">(title, </span><span style="color:#CE9178;">&quot;gt=0,lte=60&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;title&quot;</span><span style="color:#D4D4D4;">); _err != </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">			http.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(_writer, _err.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(), http.StatusBadRequest)</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">		}</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">_</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">exists</span><span style="color:#D4D4D4;"> := _req.Form[</span><span style="color:#CE9178;">&quot;content&quot;</span><span style="color:#D4D4D4;">]; exists {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">_content</span><span style="color:#D4D4D4;"> := _req.</span><span style="color:#DCDCAA;">FormValue</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;content&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#9CDCFE;">content</span><span style="color:#D4D4D4;"> = &amp;_content</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">_err</span><span style="color:#D4D4D4;"> := rest.</span><span style="color:#DCDCAA;">ValidateVar</span><span style="color:#D4D4D4;">(content, </span><span style="color:#CE9178;">&quot;gt=0,lte=1000&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;content&quot;</span><span style="color:#D4D4D4;">); _err != </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">			http.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(_writer, _err.</span><span style="color:#DCDCAA;">Error</span><span style="color:#D4D4D4;">(), http.StatusBadRequest)</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">		}</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>Chinese translation of error messages example</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">package</span><span style="color:#D4D4D4;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">import</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#CE9178;">&quot;github.com/go-playground/locales/zh&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	ut </span><span style="color:#CE9178;">&quot;github.com/go-playground/universal-translator&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	zhtrans </span><span style="color:#CE9178;">&quot;github.com/go-playground/validator/v10/translations/zh&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">uni</span><span style="color:#D4D4D4;"> := ut.</span><span style="color:#DCDCAA;">New</span><span style="color:#D4D4D4;">(zh.</span><span style="color:#DCDCAA;">New</span><span style="color:#D4D4D4;">())</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">trans</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">_</span><span style="color:#D4D4D4;"> := uni.</span><span style="color:#DCDCAA;">GetTranslator</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;zh&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">	rest.</span><span style="color:#DCDCAA;">SetTranslator</span><span style="color:#D4D4D4;">(trans)</span></span>
<span class="line"><span style="color:#D4D4D4;">	zhtrans.</span><span style="color:#DCDCAA;">RegisterDefaultTranslations</span><span style="color:#D4D4D4;">(rest.</span><span style="color:#DCDCAA;">GetValidate</span><span style="color:#D4D4D4;">(), trans)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	srv.</span><span style="color:#DCDCAA;">Run</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div>`,10);function Ms(Hs,zs){const e=p("ExternalLinkIcon"),o=p("RouterLink");return r(),t(D,null,[m,s("ul",null,[s("li",null,[s("p",null,[C,h,s("a",g,[v,a(e)])])]),s("li",null,[s("p",null,[A,E,s("a",f,[_,a(e)])])]),R,k,s("li",null,[s("p",null,[w,x,q,S,s("a",F,[N,a(e)]),P])]),G]),T,s("p",null,[B,I,s("a",L,[V,a(e)]),M]),H,s("p",null,[z,O,s("a",W,[j,a(e)]),Y]),U,s("p",null,[Z,J,K,Q,s("a",X,[$,a(e)]),ss]),ns,s("p",null,[as,es,s("a",ls,[ps,a(e)]),os]),rs,s("p",null,[ts,s("a",cs,[Ds,a(e)]),is]),ds,ys,s("ol",null,[us,s("li",null,[bs,ms,Cs,a(o,{to:"/guide/idl.html#annotations"},{default:c(()=>[hs]),_:1}),gs]),vs]),As,s("p",null,[Es,fs,_s,Rs,ks,ws,xs,qs,Ss,Fs,Ns,s("a",Ps,[Gs,a(e)]),Ts,s("a",Bs,[Is,a(e)]),Ls]),Vs],64)}var Us=u(b,[["render",Ms]]);export{Us as default};
