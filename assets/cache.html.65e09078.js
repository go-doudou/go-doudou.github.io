import{r as l,o as p,a as e,b as s,e as o,F as r,f as n,g as c}from"./app.2025f35b.js";import{_ as D}from"./plugin-vue_export-helper.21dcd24c.js";const t={},y=s("h1",{id:"cache\u6A21\u5757",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#cache\u6A21\u5757","aria-hidden":"true"},"#"),n(" Cache\u6A21\u5757")],-1),i=n("go-doudou\u96C6\u6210\u4E86"),b={href:"https://github.com/go-redis/cache",target:"_blank",rel:"noopener noreferrer"},u=n("https://github.com/go-redis/cache"),C=n("\u5E93\uFF0C\u5B9E\u73B0\u4E86\u5F00\u7BB1\u5373\u7528\u7684\u5BF9sql\u67E5\u8BE2\u7ED3\u679C\u7684\u672C\u5730\u5185\u5B58\u7F13\u5B58\u548Credis\u7F13\u5B58\u3002"),m=c(`<p><code>wrapper.DB</code>\u548C<code>wrapper.Tx</code>\u63A5\u53E3\u7684\u65B9\u6CD5\u7B7E\u540D\u4E2D\u53EA\u6709<code>GetContext(ctx context.Context, dest interface{}, query string, args ...interface{}) error</code>\u548C<code>SelectContext(ctx context.Context, dest interface{}, query string, args ...interface{}) error</code>\u96C6\u6210\u4E86\u7F13\u5B58\u673A\u5236\u3002</p><p>\u5177\u4F53\u7528\u6CD5\u8BF7\u53C2\u8003\u793A\u4F8B\u4EE3\u7801\u548C\u91CC\u9762\u7684\u6CE8\u91CA\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">func</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// \u521B\u5EFAredis\u8FDE\u63A5\u5B9E\u4F8B</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">ring</span><span style="color:#D4D4D4;"> := redis.</span><span style="color:#DCDCAA;">NewRing</span><span style="color:#D4D4D4;">(&amp;redis.RingOptions{</span></span>
<span class="line"><span style="color:#D4D4D4;">		Addrs: </span><span style="color:#569CD6;">map</span><span style="color:#D4D4D4;">[</span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">]</span><span style="color:#4EC9B0;">string</span><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#D4D4D4;">			</span><span style="color:#CE9178;">&quot;server1&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;:6379&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">		},</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// \u521B\u5EFAcache\u5B9E\u4F8B</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">mycache</span><span style="color:#D4D4D4;"> := cache.</span><span style="color:#DCDCAA;">New</span><span style="color:#D4D4D4;">(&amp;cache.Options{</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// redis\u7F13\u5B58</span></span>
<span class="line"><span style="color:#D4D4D4;">		Redis: ring,</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// \u672C\u5730\u5185\u5B58\u7F13\u5B58\uFF0C\u5982\u679C\u4E0D\u9700\u8981\u53EF\u4EE5\u5220\u53BB\u6B64\u884C</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// \u652F\u6301\u591A\u79CD\u5185\u5B58\u7F13\u5B58\u5E93\uFF0C\u8BF7\u53C2\u8003go-redis/cache\u5E93\u7684README.md\u91CC\u7684\u8BF4\u660E</span></span>
<span class="line"><span style="color:#D4D4D4;">		LocalCache:   cache.</span><span style="color:#DCDCAA;">NewTinyLFU</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1000</span><span style="color:#D4D4D4;">, time.Minute),</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// \u5F00\u542Fredis\u7F13\u5B58\u7684\u547D\u4E2D\u7EDF\u8BA1</span></span>
<span class="line"><span style="color:#D4D4D4;">		StatsEnabled: </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">u</span><span style="color:#D4D4D4;"> := dao.</span><span style="color:#DCDCAA;">NewUserDao</span><span style="color:#D4D4D4;">(wrapper.</span><span style="color:#DCDCAA;">NewGddDB</span><span style="color:#D4D4D4;">(db, </span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// wrapper.NewGddDB\u5DE5\u5382\u65B9\u6CD5\u91CC\u6CA1\u6709\u8BBE\u7F6E\u9ED8\u8BA4\u7684cache\u5B9E\u4F8B\uFF0C</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// \u6240\u4EE5\u9700\u8981\u7528\u6237\u81EA\u5DF1\u8C03\u7528wrapper.WithCache\u65B9\u6CD5\u4F20\u5165\u81EA\u5B9A\u4E49\u7684\u5B9E\u4F8B</span></span>
<span class="line"><span style="color:#D4D4D4;">        wrapper.</span><span style="color:#DCDCAA;">WithCache</span><span style="color:#D4D4D4;">(mycache), </span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// \u8C03\u7528wrapper.WithRedisKeyTTL\u65B9\u6CD5\u53EF\u4EE5\u4F20\u5165redis\u91CC\u7684key\u7684\u8FC7\u671F\u65F6\u95F4\uFF0C</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// \u53EF\u4EE5\u4E0D\u4F20\uFF0C\u9ED8\u8BA4\u503C\u662F\u4E00\u4E2A\u5C0F\u65F6</span></span>
<span class="line"><span style="color:#D4D4D4;">        wrapper.</span><span style="color:#DCDCAA;">WithRedisKeyTTL</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">*time.Second)))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// \u76F4\u63A5\u8C03\u7528dao\u5C42\u4EE3\u7801\u5373\u53EF</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">_</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">err</span><span style="color:#D4D4D4;"> = u.</span><span style="color:#DCDCAA;">Insert</span><span style="color:#D4D4D4;">(context.</span><span style="color:#DCDCAA;">TODO</span><span style="color:#D4D4D4;">(), &amp;user)</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> err != </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#DCDCAA;">panic</span><span style="color:#D4D4D4;">(err)</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">	logrus.</span><span style="color:#DCDCAA;">Printf</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;user </span><span style="color:#9CDCFE;">%s</span><span style="color:#CE9178;">&#39;s id is </span><span style="color:#9CDCFE;">%d</span><span style="color:#D7BA7D;">\\n</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">, user.Name, user.Id)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// \u76F4\u63A5\u8C03\u7528dao\u5C42\u4EE3\u7801\u5373\u53EF</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">got</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">err</span><span style="color:#D4D4D4;"> := u.</span><span style="color:#DCDCAA;">PageMany</span><span style="color:#D4D4D4;">(context.</span><span style="color:#DCDCAA;">TODO</span><span style="color:#D4D4D4;">(), Page{</span></span>
<span class="line"><span style="color:#D4D4D4;">		Orders: []Order{</span></span>
<span class="line"><span style="color:#D4D4D4;">			{</span></span>
<span class="line"><span style="color:#D4D4D4;">				Col:  </span><span style="color:#CE9178;">&quot;age&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">				Sort: </span><span style="color:#CE9178;">&quot;desc&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">			},</span></span>
<span class="line"><span style="color:#D4D4D4;">		},</span></span>
<span class="line"><span style="color:#D4D4D4;">		Offset: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">		Size:   </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">	}, </span><span style="color:#DCDCAA;">C</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">Col</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;age&quot;</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">Gt</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">27</span><span style="color:#D4D4D4;">))</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> err != </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#DCDCAA;">panic</span><span style="color:#D4D4D4;">(err)</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span></span>
<span class="line"><span style="color:#D4D4D4;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// \u91CD\u590D\u8C03\u7528\uFF0C\u53EF\u4EE5\u4ECE\u65E5\u5FD7\u4E2D\u770B\u5230\u6548\u679C</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#9CDCFE;">got</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">err</span><span style="color:#D4D4D4;"> = u.</span><span style="color:#DCDCAA;">PageMany</span><span style="color:#D4D4D4;">(context.</span><span style="color:#DCDCAA;">TODO</span><span style="color:#D4D4D4;">(), Page{</span></span>
<span class="line"><span style="color:#D4D4D4;">		Orders: []Order{</span></span>
<span class="line"><span style="color:#D4D4D4;">			{</span></span>
<span class="line"><span style="color:#D4D4D4;">				Col:  </span><span style="color:#CE9178;">&quot;age&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">				Sort: </span><span style="color:#CE9178;">&quot;desc&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">			},</span></span>
<span class="line"><span style="color:#D4D4D4;">		},</span></span>
<span class="line"><span style="color:#D4D4D4;">		Offset: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">		Size:   </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">	}, </span><span style="color:#DCDCAA;">C</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">Col</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;age&quot;</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">Gt</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">27</span><span style="color:#D4D4D4;">))</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> err != </span><span style="color:#569CD6;">nil</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">		</span><span style="color:#DCDCAA;">panic</span><span style="color:#D4D4D4;">(err)</span></span>
<span class="line"><span style="color:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;">	 </span></span>
<span class="line"><span style="color:#D4D4D4;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">	fmt.</span><span style="color:#DCDCAA;">Println</span><span style="color:#D4D4D4;">(mycache.</span><span style="color:#DCDCAA;">Stats</span><span style="color:#D4D4D4;">())</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div><p>\u65E5\u5FD7\u8F93\u51FA\u793A\u4F8B\uFF0C\u8BF7\u6CE8\u610F<code>HIT: </code>\u540E\u9762\u7684\u503C\uFF0C<code>false</code>\u8868\u793A\u672A\u547D\u4E2D\u7F13\u5B58\uFF0C<code>true</code>\u8868\u793A\u7F13\u5B58\u547D\u4E2D\u3002<code>&amp;{Hits:2 Misses:2}</code>\u8868\u793A2\u6B21\u67E5\u8BE2\u547D\u4E2D\u7F13\u5B58\uFF0C2\u6B21\u6CA1\u547D\u4E2D\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">INFO[2022-05-23 20:54:24] SQL: INSERT INTO </span><span style="color:#CE9178;">\`test\`</span><span style="color:#D4D4D4;">.</span><span style="color:#CE9178;">\`ddl_user\`</span><span style="color:#D4D4D4;"> ( </span><span style="color:#CE9178;">\`id\`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">\`name\`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">\`phone\`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">\`age\`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">\`no\`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">\`school\`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">\`is_student\`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">\`delete_at\`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">\`avg_score\`</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">\`hobby\`</span><span style="color:#D4D4D4;">) VALUES ( </span><span style="color:#CE9178;">&#39;0&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;jack&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;13552053960&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;30&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;0&#39;</span><span style="color:#D4D4D4;">, null, </span><span style="color:#CE9178;">&#39;0&#39;</span><span style="color:#D4D4D4;">, null, </span><span style="color:#CE9178;">&#39;97.53</span></span>
<span class="line"><span style="color:#CE9178;">4&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">INFO[2022-05-23 20:54:24] user jack</span><span style="color:#CE9178;">&#39;s id is 14                                                                     </span></span>
<span class="line"><span style="color:#CE9178;">INFO[2022-05-23 20:54:24] SQL: select * from ddl_user where \`age\` &gt; &#39;</span><span style="color:#D4D4D4;">27</span><span style="color:#CE9178;">&#39; order by \`age\` desc limit 0,1  HIT: false </span></span>
<span class="line"><span style="color:#CE9178;">INFO[2022-05-23 20:54:24] SQL: select count(1) from ddl_user where \`age\` &gt; &#39;</span><span style="color:#D4D4D4;">27</span><span style="color:#CE9178;">&#39; HIT: false                         </span></span>
<span class="line"><span style="color:#CE9178;">INFO[2022-05-23 20:54:24] returned user jack&#39;</span><span style="color:#D4D4D4;">s id is 14                                                            </span></span>
<span class="line"><span style="color:#D4D4D4;">INFO[2022-05-23 20:54:24] returned user jack</span><span style="color:#CE9178;">&#39;s average score is 97.534                                             </span></span>
<span class="line"><span style="color:#CE9178;">INFO[2022-05-23 20:54:24] SQL: select * from ddl_user where \`age\` &gt; &#39;</span><span style="color:#D4D4D4;">27</span><span style="color:#CE9178;">&#39; order by \`age\` desc limit 0,1  HIT: true  </span></span>
<span class="line"><span style="color:#CE9178;">INFO[2022-05-23 20:54:24] SQL: select count(1) from ddl_user where \`age\` &gt; &#39;</span><span style="color:#D4D4D4;">27</span><span style="color:#CE9178;">&#39; HIT: true                          </span></span>
<span class="line"><span style="color:#CE9178;">INFO[2022-05-23 20:54:24] returned user jack&#39;</span><span style="color:#D4D4D4;">s id is 14                                                            </span></span>
<span class="line"><span style="color:#D4D4D4;">INFO[2022-05-23 20:54:24] returned user jack</span><span style="color:#CE9178;">&#39;s average score is 97.534                                             </span></span>
<span class="line"><span style="color:#CE9178;">&amp;{Hits:2 Misses:2}                                                                                                             </span></span>
<span class="line"><span style="color:#CE9178;">INFO[2022-05-23 20:54:24] SQL: delete from ddl_user where \`age\` &gt; &#39;</span><span style="color:#D4D4D4;">27</span><span style="color:#CE9178;">&#39;;       </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div>`,5);function d(E,A){const a=l("ExternalLinkIcon");return p(),e(r,null,[y,s("p",null,[i,s("a",b,[u,o(a)]),C]),m],64)}var _=D(t,[["render",d]]);export{_ as default};
